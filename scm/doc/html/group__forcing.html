<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.12"/>
<title>GMTB Single Column Model: gmtb_scm_forcing</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="dtc_logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">GMTB Single Column Model
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.12 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('group__forcing.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">gmtb_scm_forcing<div class="ingroups"><a class="el" href="group___s_c_m.html">GMTB Single Column Model</a></div></div>  </div>
</div><!--header-->
<div class="contents">

<p>Contains subroutines to handle the SCM forcing &ndash; interpolating in space and time, etc.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="memitem:gaee4d8a92d081863df4499f2e1dce82bd"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__forcing.html#gaee4d8a92d081863df4499f2e1dce82bd">gmtb_scm_forcing::interpolate_forcing</a> (input_ntimes, input_nlev, input_w_ls, input_omega, input_u_g, input_v_g, input_u_nudge,           input_v_nudge, input_T_nudge, input_thil_nudge, input_qt_nudge, input_dT_dt_rad, input_h_advec_thetail, input_h_advec_qt,           input_v_advec_thetail, input_v_advec_qt, input_pres, input_time, input_lat, input_lon, input_pres_surf, input_T_surf, n_levels,       n_columns, grid_pres, model_time, w_ls, omega, u_g, v_g, u_nudge, v_nudge, T_nudge, thil_nudge, qt_nudge, dT_dt_rad,           h_advec_thil, h_advec_qt, v_advec_thil, v_advec_qt, lat, lon, pres_surf, T_surf)</td></tr>
<tr class="memdesc:gaee4d8a92d081863df4499f2e1dce82bd"><td class="mdescLeft">&#160;</td><td class="mdescRight">This subroutine interpolates the model forcing, column position, and surface properties to the current model time and to the model grid.  <a href="group__forcing.html#gaee4d8a92d081863df4499f2e1dce82bd">More...</a><br /></td></tr>
<tr class="separator:gaee4d8a92d081863df4499f2e1dce82bd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaa9a429a52d986be1bc2458f56e8f77aa"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__forcing.html#gaa9a429a52d986be1bc2458f56e8f77aa">gmtb_scm_forcing::apply_forcing_leapfrog</a> (n_levels, n_columns, state_tracer, state_T, state_u, state_v, w_ls, omega, u_g, v_g, u_nudge,   v_nudge, T_nudge, thil_nudge, qt_nudge, dT_dt_rad, h_advec_thil, h_advec_qt, v_advec_thil, v_advec_qt, exner_l, phii, pres_l,   lat, dt, thermo_forcing_type, mom_forcing_type, relax_time, u_force_tend, v_force_tend, T_force_tend, qv_force_tend)</td></tr>
<tr class="memdesc:gaa9a429a52d986be1bc2458f56e8f77aa"><td class="mdescLeft">&#160;</td><td class="mdescRight">This subroutine updates the state variables due to the model forcing using the leapfrog time integration scheme. It overwrites the state variable arrays where the filtered values from the previous time step are kept. These parts of the state variable arrays are pointed to by the state_fields_in DDT and are later updated by calling nuopc_phys_run.  <a href="group__forcing.html#gaa9a429a52d986be1bc2458f56e8f77aa">More...</a><br /></td></tr>
<tr class="separator:gaa9a429a52d986be1bc2458f56e8f77aa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga9f9e7db891365f55c3ce79e70a8fe580"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__forcing.html#ga9f9e7db891365f55c3ce79e70a8fe580">gmtb_scm_forcing::apply_forcing_forward_euler</a> (n_levels, n_columns, state_tracer, state_T, state_u, state_v, w_ls, omega, u_g, v_g,   u_nudge, v_nudge, T_nudge, thil_nudge, qt_nudge, dT_dt_rad, h_advec_thil, h_advec_qt, v_advec_thil, v_advec_qt, exner_l, phii,   pres_l, lat, dt, thermo_forcing_type, mom_forcing_type, relax_time, u_force_tend, v_force_tend, T_force_tend, qv_force_tend)</td></tr>
<tr class="separator:ga9f9e7db891365f55c3ce79e70a8fe580"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>Contains subroutines to handle the SCM forcing &ndash; interpolating in space and time, etc. </p>
<h2 class="groupheader">Function/Subroutine Documentation</h2>
<a class="anchor" id="ga9f9e7db891365f55c3ce79e70a8fe580"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine gmtb_scm_forcing::apply_forcing_forward_euler </td>
          <td>(</td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>n_levels</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>n_columns</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=dp), dimension(:,:,:,:), intent(inout)&#160;</td>
          <td class="paramname"><em>state_tracer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=dp), dimension(:,:,:), intent(inout)&#160;</td>
          <td class="paramname"><em>state_T</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=dp), dimension(:,:,:), intent(inout)&#160;</td>
          <td class="paramname"><em>state_u</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=dp), dimension(:,:,:), intent(inout)&#160;</td>
          <td class="paramname"><em>state_v</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=dp), dimension(:,:), intent(in)&#160;</td>
          <td class="paramname"><em>w_ls</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=dp), dimension(:,:), intent(in)&#160;</td>
          <td class="paramname"><em>omega</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=dp), dimension(:,:), intent(in)&#160;</td>
          <td class="paramname"><em>u_g</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=dp), dimension(:,:), intent(in)&#160;</td>
          <td class="paramname"><em>v_g</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=dp), dimension(:,:), intent(in)&#160;</td>
          <td class="paramname"><em>u_nudge</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=dp), dimension(:,:), intent(in)&#160;</td>
          <td class="paramname"><em>v_nudge</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=dp), dimension(:,:), intent(in)&#160;</td>
          <td class="paramname"><em>T_nudge</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=dp), dimension(:,:), intent(in)&#160;</td>
          <td class="paramname"><em>thil_nudge</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=dp), dimension(:,:), intent(in)&#160;</td>
          <td class="paramname"><em>qt_nudge</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=dp), dimension(:,:), intent(in)&#160;</td>
          <td class="paramname"><em>dT_dt_rad</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=dp), dimension(:,:), intent(in)&#160;</td>
          <td class="paramname"><em>h_advec_thil</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=dp), dimension(:,:), intent(in)&#160;</td>
          <td class="paramname"><em>h_advec_qt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=dp), dimension(:,:), intent(in)&#160;</td>
          <td class="paramname"><em>v_advec_thil</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=dp), dimension(:,:), intent(in)&#160;</td>
          <td class="paramname"><em>v_advec_qt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=dp), dimension(:,:), intent(in)&#160;</td>
          <td class="paramname"><em>exner_l</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=dp), dimension(:,:), intent(in)&#160;</td>
          <td class="paramname"><em>phii</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=dp), dimension(:,:), intent(in)&#160;</td>
          <td class="paramname"><em>pres_l</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=dp), dimension(:), intent(in)&#160;</td>
          <td class="paramname"><em>lat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=dp), intent(in)&#160;</td>
          <td class="paramname"><em>dt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>thermo_forcing_type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>mom_forcing_type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=dp), intent(in)&#160;</td>
          <td class="paramname"><em>relax_time</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=dp), dimension(:,:), intent(out)&#160;</td>
          <td class="paramname"><em>u_force_tend</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=dp), dimension(:,:), intent(out)&#160;</td>
          <td class="paramname"><em>v_force_tend</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=dp), dimension(:,:), intent(out)&#160;</td>
          <td class="paramname"><em>T_force_tend</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=dp), dimension(:,:), intent(out)&#160;</td>
          <td class="paramname"><em>qv_force_tend</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">n_columns</td><td>number of model columns</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">n_levels</td><td>number of model levels</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">state_tracer</td><td>model state tracers (horizontal, vertical, tracer, iteration)</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">state_t</td><td>model state temperature (horizontal, vertical, iteration)</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">state_u</td><td>model state zonal wind (horizontal, vertical, iteration)</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">state_v</td><td>model state meridional wind (horizontal, vertical, iteration)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">w_ls</td><td>large scale w (m/s) (horizontal, vertical)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">omega</td><td>large scale pressure velocity (Pa/s) (horizontal, vertical)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">u_g</td><td>geostrophic zonal wind (m/s) (horizontal, vertical)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">v_g</td><td>geostrophic meridional wind (m/s) (horizontal, vertical)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">u_nudge</td><td>nudging zonal wind (m/s) (horizontal, vertical)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">v_nudge</td><td>nudging meridional wind (m/s) (horizontal, vertical)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">t_nudge</td><td>nudging abs. temperatuere (K) (horizontal, vertical)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">thil_nudge</td><td>nudging liq. pot. temperature (K) (horizontal, vertical)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">qt_nudge</td><td>nudging specific humidity (kg/kg) (horizontal, vertical)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">dt_dt_rad</td><td>radiative heating rate (K/s) (horizontal, vertical)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">h_advec_thil</td><td>change in theta_il due to horizontal advection (K/s) (horizontal, vertical)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">h_advec_qt</td><td>change in q_t due to horizontal advection (kg/kg /s) (horizontal, vertical)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">v_advec_thil</td><td>change in theta_il due to vertical advection (K/s) (horizontal, vertical)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">v_advec_qt</td><td>change in q_t due to vertical advection (kg/kg /s) (horizontal, vertical)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">dt</td><td>time step (s)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">lat</td><td>latitude in radians</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">exner_l</td><td>exner function at model level centers (horizontal, vertical)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">phii</td><td>geopotential at model level interfaces (horizontal, vertical)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">pres_l</td><td>pressure at model level centers (horizontal, vertical)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">thermo_forcing_type</td><td>1: "revealed forcing", 2: "horizontal advective forcing", 3: "relaxation forcing"</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">mom_forcing_type</td><td>1: "revealed forcing", 2: "horizontal advective forcing", 3: "relaxation forcing"</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">relax_time</td><td>time scale for hor. wind nudging</td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">u_force_tend</td><td>sum of all forcing for zonal momentum (horizontal, vertical)</td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">v_force_tend</td><td>sum of all forcing for meridional momentum (horizontal, vertical)</td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">t_force_tend</td><td>sum of all forcing for temperature (horizontal, vertical)</td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">qv_force_tend</td><td>sum of all forcing for water vapor (horizontal, vertical) </td></tr>
  </table>
  </dd>
</dl>
<h1><a class="anchor" id="apply_leapfrog_forcing_alg"></a>
Algorithm</h1>
<ul>
<li>Save old state variables (filtered from previous time step)</li>
<li>Initialize forcing sums to zero.<ul>
<li>Calculate w_ls and z (height) at model layer interfaces.</li>
</ul>
</li>
<li>Calculate change in state momentum variables due to vertical advection (subsidence).<ul>
<li>Calculate tendencies due to vertical advection using same discretization as in previous GFS SCM implmentation (staggered central difference) <p class="formulaDsp">
\[ \frac{\partial x}{\partial t}|_{vert. advection} = \frac{w_{k+1}\left(x_{k+1} - x_{k}\right) + w_k\left(x_k - x_{k-1}\right)}{-2\left(z_{k+1}-z_{k}\right)} \]
</p>
 where \(w\) is the vertical velocity on interface levels, \(x\) is some state variable on grid centers, \(z\) is the height of interface levels. An model layer shares the same index as the interface below.</li>
<li>Handle the top and bottom levels separately using special discretizations.</li>
</ul>
</li>
<li>Add forcing due to geostrophic wind<ul>
<li>Calculate Coriolis parameter.</li>
</ul>
</li>
<li>Calculate change in state momentum variables due to nudging.</li>
<li>Add forcing due to prescribed radiation and horizontal advection</li>
<li>Add forcing due to prescribed radiation and horizontal advection</li>
<li>Calculate change in state temperature/moisture variables due to nudging.</li>
<li>Update the state variables using the forward Euler scheme: <p class="formulaDsp">
\[ x^{\tau + 1} = x^{\tau} + \Delta t\frac{\partial x}{\partial t}|^\tau_{forcing} \]
</p>
 \(x^{\tau}\) is the value at the previous time step and \(\frac{\partial x}{\partial t}|^\tau_{forcing}\) is the sum of forcing terms calculated in this time step.</li>
</ul>

<p>Definition at line <a class="el" href="gmtb__scm__forcing_8f90_source.html#l00571">571</a> of file <a class="el" href="gmtb__scm__forcing_8f90_source.html">gmtb_scm_forcing.f90</a>.</p>

<p>Referenced by <a class="el" href="gmtb__scm__time__integration_8f90_source.html#l00054">gmtb_scm_time_integration::do_time_step()</a>.</p>

</div>
</div>
<a class="anchor" id="gaa9a429a52d986be1bc2458f56e8f77aa"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine gmtb_scm_forcing::apply_forcing_leapfrog </td>
          <td>(</td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>n_levels</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>n_columns</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=dp), dimension(:,:,:,:), intent(inout)&#160;</td>
          <td class="paramname"><em>state_tracer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=dp), dimension(:,:,:), intent(inout)&#160;</td>
          <td class="paramname"><em>state_T</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=dp), dimension(:,:,:), intent(inout)&#160;</td>
          <td class="paramname"><em>state_u</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=dp), dimension(:,:,:), intent(inout)&#160;</td>
          <td class="paramname"><em>state_v</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=dp), dimension(:,:), intent(in)&#160;</td>
          <td class="paramname"><em>w_ls</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=dp), dimension(:,:), intent(in)&#160;</td>
          <td class="paramname"><em>omega</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=dp), dimension(:,:), intent(in)&#160;</td>
          <td class="paramname"><em>u_g</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=dp), dimension(:,:), intent(in)&#160;</td>
          <td class="paramname"><em>v_g</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=dp), dimension(:,:), intent(in)&#160;</td>
          <td class="paramname"><em>u_nudge</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=dp), dimension(:,:), intent(in)&#160;</td>
          <td class="paramname"><em>v_nudge</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=dp), dimension(:,:), intent(in)&#160;</td>
          <td class="paramname"><em>T_nudge</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=dp), dimension(:,:), intent(in)&#160;</td>
          <td class="paramname"><em>thil_nudge</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=dp), dimension(:,:), intent(in)&#160;</td>
          <td class="paramname"><em>qt_nudge</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=dp), dimension(:,:), intent(in)&#160;</td>
          <td class="paramname"><em>dT_dt_rad</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=dp), dimension(:,:), intent(in)&#160;</td>
          <td class="paramname"><em>h_advec_thil</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=dp), dimension(:,:), intent(in)&#160;</td>
          <td class="paramname"><em>h_advec_qt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=dp), dimension(:,:), intent(in)&#160;</td>
          <td class="paramname"><em>v_advec_thil</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=dp), dimension(:,:), intent(in)&#160;</td>
          <td class="paramname"><em>v_advec_qt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=dp), dimension(:,:), intent(in)&#160;</td>
          <td class="paramname"><em>exner_l</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=dp), dimension(:,:), intent(in)&#160;</td>
          <td class="paramname"><em>phii</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=dp), dimension(:,:), intent(in)&#160;</td>
          <td class="paramname"><em>pres_l</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=dp), dimension(:), intent(in)&#160;</td>
          <td class="paramname"><em>lat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=dp), intent(in)&#160;</td>
          <td class="paramname"><em>dt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>thermo_forcing_type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>mom_forcing_type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=dp), intent(in)&#160;</td>
          <td class="paramname"><em>relax_time</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=dp), dimension(:,:), intent(out)&#160;</td>
          <td class="paramname"><em>u_force_tend</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=dp), dimension(:,:), intent(out)&#160;</td>
          <td class="paramname"><em>v_force_tend</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=dp), dimension(:,:), intent(out)&#160;</td>
          <td class="paramname"><em>T_force_tend</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=dp), dimension(:,:), intent(out)&#160;</td>
          <td class="paramname"><em>qv_force_tend</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This subroutine updates the state variables due to the model forcing using the leapfrog time integration scheme. It overwrites the state variable arrays where the filtered values from the previous time step are kept. These parts of the state variable arrays are pointed to by the state_fields_in DDT and are later updated by calling nuopc_phys_run. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">n_columns</td><td>number of model columns</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">n_levels</td><td>number of model levels</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">state_tracer</td><td>model state tracers (horizontal, vertical, tracer, iteration)</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">state_t</td><td>model state temperature (horizontal, vertical, iteration)</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">state_u</td><td>model state zonal wind (horizontal, vertical, iteration)</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">state_v</td><td>model state meridional wind (horizontal, vertical, iteration)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">w_ls</td><td>large scale w (m/s) (horizontal, vertical)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">omega</td><td>large scale pressure velocity (Pa/s) (horizontal, vertical)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">u_g</td><td>geostrophic zonal wind (m/s) (horizontal, vertical)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">v_g</td><td>geostrophic meridional wind (m/s) (horizontal, vertical)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">u_nudge</td><td>nudging zonal wind (m/s) (horizontal, vertical)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">v_nudge</td><td>nudging meridional wind (m/s) (horizontal, vertical)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">t_nudge</td><td>nudging abs. temperatuere (K) (horizontal, vertical)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">thil_nudge</td><td>nudging liq. pot. temperature (K) (horizontal, vertical)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">qt_nudge</td><td>nudging specific humidity (kg/kg) (horizontal, vertical)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">dt_dt_rad</td><td>radiative heating rate (K/s) (horizontal, vertical)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">h_advec_thil</td><td>change in theta_il due to horizontal advection (K/s) (horizontal, vertical)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">h_advec_qt</td><td>change in q_t due to horizontal advection (kg/kg /s) (horizontal, vertical)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">v_advec_thil</td><td>change in theta_il due to vertical advection (K/s) (horizontal, vertical)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">v_advec_qt</td><td>change in q_t due to vertical advection (kg/kg /s) (horizontal, vertical)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">dt</td><td>time step (s)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">lat</td><td>latitude in radians</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">exner_l</td><td>exner function at model level centers (horizontal, vertical)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">phii</td><td>geopotential at model level interfaces (horizontal, vertical)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">pres_l</td><td>pressure at model level centers (horizontal, vertical)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">thermo_forcing_type</td><td>1: "revealed forcing", 2: "horizontal advective forcing", 3: "relaxation forcing"</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">mom_forcing_type</td><td>1: "revealed forcing", 2: "horizontal advective forcing", 3: "relaxation forcing"</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">relax_time</td><td>time scale for hor. wind nudging</td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">u_force_tend</td><td>sum of all forcing for zonal momentum (horizontal, vertical)</td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">v_force_tend</td><td>sum of all forcing for meridional momentum (horizontal, vertical)</td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">t_force_tend</td><td>sum of all forcing for temperature (horizontal, vertical)</td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">qv_force_tend</td><td>sum of all forcing for water vapor (horizontal, vertical) </td></tr>
  </table>
  </dd>
</dl>
<h1><a class="anchor" id="apply_leapfrog_forcing_alg"></a>
Algorithm</h1>
<ul>
<li>Save old state variables (filtered from previous time step)</li>
<li>Initialize forcing sums to zero.<ul>
<li>Calculate w_ls and z (height) at model layer interfaces.</li>
</ul>
</li>
<li>Calculate change in state momentum variables due to vertical advection (subsidence).<ul>
<li>Calculate tendencies due to vertical advection using same discretization as in previous GFS SCM implmentation (staggered central difference) <p class="formulaDsp">
\[ \frac{\partial x}{\partial t}|_{vert. advection} = \frac{w_{k+1}\left(x_{k+1} - x_{k}\right) + w_k\left(x_k - x_{k-1}\right)}{-2\left(z_{k+1}-z_{k}\right)} \]
</p>
 where \(w\) is the vertical velocity on interface levels, \(x\) is some state variable on grid centers, \(z\) is the height of interface levels. An model layer shares the same index as the interface below.</li>
<li>Handle the top and bottom levels separately using special discretizations.</li>
</ul>
</li>
<li>Add forcing due to geostrophic wind<ul>
<li>Calculate Coriolis parameter.</li>
</ul>
</li>
<li>Calculate change in state momentum variables due to nudging.</li>
<li>Add forcing due to prescribed radiation and horizontal advection</li>
<li>Add forcing due to prescribed radiation and horizontal advection</li>
<li>Calculate change in state temperature/moisture variables due to nudging.</li>
<li>Update the state variables using the leapfrog scheme: <p class="formulaDsp">
\[ x^{\tau + 1} = \overline{x^{\tau - 1}} + 2\Delta t\frac{\partial x}{\partial t}|^\tau_{forcing} \]
</p>
 \(\overline{x^{\tau - 1}}\) is the filtered value at the previous time step and \(\frac{\partial x}{\partial t}|^\tau_{forcing}\) is the sum of forcing terms calculated in this time step.</li>
</ul>

<p>Definition at line <a class="el" href="gmtb__scm__forcing_8f90_source.html#l00308">308</a> of file <a class="el" href="gmtb__scm__forcing_8f90_source.html">gmtb_scm_forcing.f90</a>.</p>

<p>Referenced by <a class="el" href="gmtb__scm__time__integration_8f90_source.html#l00054">gmtb_scm_time_integration::do_time_step()</a>.</p>

</div>
</div>
<a class="anchor" id="gaee4d8a92d081863df4499f2e1dce82bd"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine gmtb_scm_forcing::interpolate_forcing </td>
          <td>(</td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>input_ntimes</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>input_nlev</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=dp), dimension(:,:), intent(in)&#160;</td>
          <td class="paramname"><em>input_w_ls</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=dp), dimension(:,:), intent(in)&#160;</td>
          <td class="paramname"><em>input_omega</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=dp), dimension(:,:), intent(in)&#160;</td>
          <td class="paramname"><em>input_u_g</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=dp), dimension(:,:), intent(in)&#160;</td>
          <td class="paramname"><em>input_v_g</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=dp), dimension(:,:), intent(in)&#160;</td>
          <td class="paramname"><em>input_u_nudge</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=dp), dimension(:,:), intent(in)&#160;</td>
          <td class="paramname"><em>input_v_nudge</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=dp), dimension(:,:), intent(in)&#160;</td>
          <td class="paramname"><em>input_T_nudge</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=dp), dimension(:,:), intent(in)&#160;</td>
          <td class="paramname"><em>input_thil_nudge</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=dp), dimension(:,:), intent(in)&#160;</td>
          <td class="paramname"><em>input_qt_nudge</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=dp), dimension(:,:), intent(in)&#160;</td>
          <td class="paramname"><em>input_dT_dt_rad</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=dp), dimension(:,:), intent(in)&#160;</td>
          <td class="paramname"><em>input_h_advec_thetail</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=dp), dimension(:,:), intent(in)&#160;</td>
          <td class="paramname"><em>input_h_advec_qt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=dp), dimension(:,:), intent(in)&#160;</td>
          <td class="paramname"><em>input_v_advec_thetail</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=dp), dimension(:,:), intent(in)&#160;</td>
          <td class="paramname"><em>input_v_advec_qt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=dp), dimension(:), intent(in)&#160;</td>
          <td class="paramname"><em>input_pres</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=dp), dimension(:), intent(in)&#160;</td>
          <td class="paramname"><em>input_time</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=dp), dimension(:), intent(in)&#160;</td>
          <td class="paramname"><em>input_lat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=dp), dimension(:), intent(in)&#160;</td>
          <td class="paramname"><em>input_lon</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=dp), dimension(:), intent(in)&#160;</td>
          <td class="paramname"><em>input_pres_surf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=dp), dimension(:), intent(in)&#160;</td>
          <td class="paramname"><em>input_T_surf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>n_levels</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>n_columns</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=dp), dimension(:,:), intent(in)&#160;</td>
          <td class="paramname"><em>grid_pres</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=dp), intent(in)&#160;</td>
          <td class="paramname"><em>model_time</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=dp), dimension(:,:), intent(out)&#160;</td>
          <td class="paramname"><em>w_ls</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=dp), dimension(:,:), intent(out)&#160;</td>
          <td class="paramname"><em>omega</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=dp), dimension(:,:), intent(out)&#160;</td>
          <td class="paramname"><em>u_g</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=dp), dimension(:,:), intent(out)&#160;</td>
          <td class="paramname"><em>v_g</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=dp), dimension(:,:), intent(out)&#160;</td>
          <td class="paramname"><em>u_nudge</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=dp), dimension(:,:), intent(out)&#160;</td>
          <td class="paramname"><em>v_nudge</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=dp), dimension(:,:), intent(out)&#160;</td>
          <td class="paramname"><em>T_nudge</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=dp), dimension(:,:), intent(out)&#160;</td>
          <td class="paramname"><em>thil_nudge</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=dp), dimension(:,:), intent(out)&#160;</td>
          <td class="paramname"><em>qt_nudge</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=dp), dimension(:,:), intent(out)&#160;</td>
          <td class="paramname"><em>dT_dt_rad</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=dp), dimension(:,:), intent(out)&#160;</td>
          <td class="paramname"><em>h_advec_thil</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=dp), dimension(:,:), intent(out)&#160;</td>
          <td class="paramname"><em>h_advec_qt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=dp), dimension(:,:), intent(out)&#160;</td>
          <td class="paramname"><em>v_advec_thil</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=dp), dimension(:,:), intent(out)&#160;</td>
          <td class="paramname"><em>v_advec_qt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=dp), dimension(:), intent(out)&#160;</td>
          <td class="paramname"><em>lat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=dp), dimension(:), intent(out)&#160;</td>
          <td class="paramname"><em>lon</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=dp), dimension(:), intent(out)&#160;</td>
          <td class="paramname"><em>pres_surf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=dp), dimension(:), intent(out)&#160;</td>
          <td class="paramname"><em>T_surf</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This subroutine interpolates the model forcing, column position, and surface properties to the current model time and to the model grid. </p>
<dl class="section note"><dt>Note</dt><dd>The input forcing file contains forcing for one column, yet the SCM code can accommodate more than one column. Right now, all columns are assumed to have the same forcing.</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">input_ntimes</td><td>number of forcing profiles in the input file corresponding to changing forcing in time</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">input_nlev</td><td>number of levels in each input forcing profile</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">input_w_ls</td><td>input large-scale w (m/s) (time, levels)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">input_omega</td><td>input large-scale omega (Pa/s) (time, levels)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">input_u_g</td><td>input geostrophic zonal wind (m/s) (time, levels)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">input_v_g</td><td>input geostrophic meridional wind (m/s) (time, levels)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">input_u_nudge</td><td>input nudging zonal wind (m/s) (time, levels)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">input_v_nudge</td><td>input nudging meridional wind (m/s) (time, levels)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">input_t_nudge</td><td>input nudging abs. temperature (K)) (time, levels)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">input_thil_nudge</td><td>input nudging liq. pot. temperature (K) (time, levels)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">input_qt_nudge</td><td>input nudging specific humidity (kg/kg) (time, levels)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">input_dt_dt_rad</td><td>input radiative heating rate (K/s) (time, levels)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">input_h_advec_thetail</td><td>input change in theta_il due to horizontal advection (K/s) (time, levels)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">input_h_advec_qt</td><td>input change in q_t due to horizontal advection (kg/kg /s) (time, levels)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">input_v_advec_thetail</td><td>input change in theta_il due to vertical advection (K/s) (time, levels)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">input_v_advec_qt</td><td>input change in q_t due to vertical advection (kg/kg /s) (time, levels)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">input_pres</td><td>input pressure levels (Pa) (levels)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">input_time</td><td>input times (s) (time)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">input_lat</td><td>input latitude (degrees) (time)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">input_lon</td><td>input longitude (degrees) (time)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">input_pres_surf</td><td>input surface pressure (Pa) (time)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">input_t_surf</td><td>input surface temperature (K) (time)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">n_levels</td><td>number of model levels</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">n_columns</td><td>number of model columns</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">grid_pres</td><td>pressure at grid centers (Pa) (horizontal, vertical)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">model_time</td><td>current model elapsed time (s)</td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">w_ls</td><td>output large scale w (m/s) (horizontal, vertical)</td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">omega</td><td>output large scale pressure velocity (Pa/s) (horizontal, vertical)</td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">u_g</td><td>output geostrophic zonal wind (m/s) (horizontal, vertical)</td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">v_g</td><td>output geostrophic meridional wind (m/s) (horizontal, vertical)</td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">u_nudge</td><td>output nudging zonal wind (m/s) (horizontal, vertical)</td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">v_nudge</td><td>output nudging meridional wind (m/s) (horizontal, vertical)</td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">t_nudge</td><td>output nudging abs. temperature (K) (horizontal, vertical)</td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">thil_nudge</td><td>output nudging liq. pot. temperature (K) (horizontal, vertical)</td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">qt_nudge</td><td>output nudging specific humidity (kg/kg) (horizontal, vertical)</td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">dt_dt_rad</td><td>output radiative heating rate (K/s) (horizontal, vertical)</td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">h_advec_thil</td><td>output change in theta_il due to horizontal advection (K/s) (horizontal, vertical)</td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">h_advec_qt</td><td>output change in q_t due to horizontal advection (kg/kg /s) (horizontal, vertical)</td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">v_advec_thil</td><td>output change in theta_il due to vertical advection (K/s) (horizontal, vertical)</td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">v_advec_qt</td><td>output change in q_t due to vertical advection (kg/kg /s) (horizontal, vertical)</td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">lat</td><td>output latitude (horizontal)</td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">lon</td><td>output longitude (horizontal)</td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">pres_surf</td><td>output surface pressure (Pa) (horizontal)</td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">t_surf</td><td>output surface temperature (K) (horizontal) </td></tr>
  </table>
  </dd>
</dl>
<h1><a class="anchor" id="interpolate_forcing_alg"></a>
Algorithm</h1>
<ul>
<li>Check for the case where the elapsed model time extends beyond the supplied forcing.<ul>
<li>If so, hold the forcing terms constant at the last supplied values. The forcing still needs to be interpolated to the grid.</li>
<li>For all forcing terms, call interpolate_to_grid_centers from <a class="el" href="group__utils.html">gmtb_scm_utils</a> for each variable. This subroutine returns the last vertical index calculated in case forcing terms above the case input needs to be specified.</li>
<li>If the input forcing file does not reach to the model domain top, fill in values above the input forcing file domain with those from the top level.</li>
<li>For this case, no time interpolation is necessary; just set the forcing terms to the vertically-interpolated values.</li>
<li>Set the surface parameters to the last available data.</li>
<li>Convert lat, lon to radians.</li>
</ul>
</li>
<li>When the model elapsed time is within the time-frame specified by the input forcing, the forcing must be interpolated in time and space.<ul>
<li>Determine the index in the input file for the time immediately preceeding the model time and determine the linear interpolation value.</li>
<li>For all forcing terms, call interpolate_to_grid_centers from <a class="el" href="group__utils.html">gmtb_scm_utils</a> for each variable for each time level that "bracket" around the current model time. This subroutine returns the last vertical index calculated in case forcing terms above the case input needs to be specified.</li>
<li>If the input forcing file does not reach to the model domain top, fill in values above the input forcing file domain with those from the top level.</li>
<li>Interpolate the forcing terms in time.</li>
<li>Interpolate the surface parameters in time.</li>
<li>Convert lat, lon to radians.</li>
</ul>
</li>
</ul>

<p>Definition at line <a class="el" href="gmtb__scm__forcing_8f90_source.html#l00028">28</a> of file <a class="el" href="gmtb__scm__forcing_8f90_source.html">gmtb_scm_forcing.f90</a>.</p>

<p>References <a class="el" href="gmtb__scm__utils_8f90_source.html#l00040">gmtb_scm_utils::interpolate_to_grid_centers()</a>.</p>

<p>Referenced by <a class="el" href="gmtb__scm_8f90_source.html#l00031">gmtb_scm_main::gmtb_scm_main_sub()</a>.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.12 </li>
  </ul>
</div>
</body>
</html>
