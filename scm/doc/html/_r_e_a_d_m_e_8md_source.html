<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.12"/>
<title>GMTB Single Column Model with CCPP: README.md Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="dtc_logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">GMTB Single Column Model with CCPP
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.12 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('_r_e_a_d_m_e_8md.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">README.md</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;# User&#39;s Guide</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;This code is a testing platform for the Common Community Physics Package (CCPP) and its</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;driver. As of v0.1.0, this code simply calls a &quot;do-nothing&quot; physics suite with</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;&quot;do-nothing&quot; physics schemes through the CCPP driver within the SCM framework. It</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;represents a proof-of-concept and a platform on which to add proper physics in the coming months.</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;The CCPP and its driver are separated into its [own repository](https://github.com/NCAR/gmtb-ccpp) and are pulled in to this SCM</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;code as a git submodule. The instructions below explain how to obtain the SCM code, bring</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;in the CCPP as a submodule, build the combined code into an application, and run a simple case.</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;Using the dummy physics, when the SCM runs, it performs all functions as if it is running</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;a real case (including time-stepping), but instead of calling real physics, it calls the</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;dummy physics, which simply print a confirmation message when called.</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;## Obtaining Code</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;1. Download a compressed file or clone the source using</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;* `git clone https://[username]@github.com/NCAR/gmtb-scm.git`</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;  and enter your github password when prompted.</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;2. Change directory into the project.</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;* `cd gmtb-scm`</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;3. Initialize the CCPP submodule.</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;* `git submodule init`</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;4. Update the CCPP submodule.</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;* `git submodule update`</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;  and enter your github credentials again. If the machine is running an older version of git and you are denied access, you may need to configure the CCPP submodule URL before repeating step 4 by executing this command:</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;* `git config submodule.src/ccpp.url https://[username]@github.com/NCAR/gmtb-ccpp.git`</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;5. Change directory into the CCPP source.</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;* `cd src/ccpp`</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;6. Checkout a branch or tag.</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;* `git checkout master` or</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;* `git checkout v0.1.0`</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;## Building and Compiling the SCM with CCPP</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;1. Change directory to the top-level directory.</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;* `cd ../..`</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;2. [Optional] Run the machine setup script if necessary. This script loads compiler modules (Fortran 2003-compliant Intel), netCDF module, etc. and sets compiler environment variables.</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;* `source Theia_setup` or</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;* `source Yellowstone_setup` or</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;* `source Cheyenne_setup`</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;3. Make a build directory and change into it.</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;* `mkdir bin &amp;&amp; cd bin`</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;4. Invoke cmake on the source code to build.</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;* `cmake ../src`</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;5. Compile.</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;* `make`</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;## Running the SCM with CCPP</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;1. First append the library path to the physics suite libraries that you need within the CCPP. For example, for the dummy schemes, use</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;* `setenv LD_LIBRARY_PATH $LD_LIBRARY_PATH\:[/path/to/build/directory/]ccpp/schemes/scm/src/scm-build`</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;2. Run the SCM with one of the supplied cases (twpice, arm_sgp_summer_1997, astex). The SCM will go through the time steps, applying forcing and calling the dummy physics.</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;* `./gmtb_scm twpice`</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;## Setting up the physics suite</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;First, a physics suite is defined using an XML file located in src/ccpp/examples. The XML file contains the suite name, the number of suite &quot;parts&quot; (suite parts exist so that an atmosphere &quot;cap&quot; can execute code between calls to the physics driver), the number of subcycles for each scheme (if physics schemes require smaller time steps than the dynamics), and the scheme names. Scheme names found in the suite XML files must correspond to schemes located within the ccpp/schemes directory. Schemes within this directory are compiled as their own libraries, whose names must also be specified when using a scheme.</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;Using a suite in the SCM framework involves specifying its name in the case configuration file to be used. For example, for the twpice case (case_config/twpice.nml), the variable &#39;physics suite&#39; is set to the desired suite name. NOTE: As mentioned in the &#39;Running&#39; section above, since the schemes are in their own libraries, you must specify the path to the compiled scheme libraries that are being used in the suite by appending the LD_LIBRARY_PATH (or DYLD_LIBRARY_PATH for Mac OS). Without this step, the scheme libraries will not be found at runtime. This step is likely temporary and will be handled automatically at build time in future versions.</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;## CCPP Implementation Notes</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;Interaction with the CCPP is accomplished in two source files: gmtb_scm.f90 and gmtb_scm_time_integration.f90. Within gmtb_scm.f90, before the time integration loop, the physics suite is initialized by calling &#39;ccpp_init&#39; with the path to the suite XML file and the ccpp_t data type to be filled in. Immediately following, the &#39;ccpp_fields_add&#39; subroutine is called to fill in the ccpp_t data type with the model data that is used (input, output, diagnostics, etc.) in the physics suite. Once the ccpp_t data type is filled, the physics suite can be called with the &#39;ccpp_ipd_run&#39; routine, passing in the scheme to be called and the ccpp_t data type. For the SCM, the first time step is handled after initialization. To advance in the time loop, the &#39;do_time_step&#39; subroutine is called from gmtb_scm_time_integration.f90. This subroutine handles applying SCM forcing and calling the physics. For testing purposes, the parts, subcycle loops, and schemes within the physics suite are looped through, although calls to ccpp_ipd_run can be split apart as necessary with code executed between calls. The &#39;atmosphere&#39; cap has the control over how to call the schemes.</div></div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><b>README.md</b></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.12 </li>
  </ul>
</div>
</body>
</html>
