<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.12"/>
<title>GMTB Single Column Model: gmtb_scm_main Module Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="dtc_logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">GMTB Single Column Model
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.12 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('namespacegmtb__scm__main.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions/Subroutines</a>  </div>
  <div class="headertitle">
<div class="title">gmtb_scm_main Module Reference<div class="ingroups"><a class="el" href="group___s_c_m.html">GMTB Single Column Model</a></div></div>  </div>
</div><!--header-->
<div class="contents">

<p>Main SCM program.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions/Subroutines</h2></td></tr>
<tr class="memitem:af2e62134ed0a98729f7dbc2d5753e547"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacegmtb__scm__main.html#af2e62134ed0a98729f7dbc2d5753e547">gmtb_scm_main_sub</a> ()</td></tr>
<tr class="separator:af2e62134ed0a98729f7dbc2d5753e547"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Main SCM program. </p>
<dl class="section author"><dt>Author</dt><dd>Grant J. Firl </dd></dl>
<dl class="section date"><dt>Date</dt><dd>March-April 2016</dd></dl>
<p>The prototype SCM relies heavily on the standalone driver provided by Patrick Tripp. The standalone driver demonstrates how to use the nuopc_physics module to calculate tendencies due to radiation and the rest of the physics suite once, including initialization. It uses 8 columns and it initializes GFS state variables from unformatted binary output files that are (I believe) generated from a GFS model run.</p>
<p>The SCM prototype differs from the standalone driver in several important ways. First, although the state arrays will maintain a "horizontal" dimension (be capable of representing more than one column), the code is designed to use a single column. Second, in order to avoid becoming a GFS-only SCM, input is achieved through host-model agnostic netCDF files. In addition, variables needed to initialize or configure the physics suite are obtained through external namelist files to avoid using GFS output files. Third, the model will have the ability to use different vertical grids and coordinates as well as different time-stepping schemes (initial capability follows the GFS, however). Fourth, the SCM includes functionality to advance through time, calling physics repeatedly, and to replace dynamics/advection with specified large-scale forcing.</p>
<p>The code is organized as follows:</p><ul>
<li>Modules are loaded, GMTB SCM modules first, followed by modules needed for NUOPC driver and GFS physics_suite</li>
<li>Variable definition</li>
<li>Namelist definition</li>
<li>Model configuration either read from file or from command line</li>
<li>Case initialization and forcing file read in</li>
<li>Reference profile for use above initialization data read in</li>
<li>Vertical grid is set up</li>
<li>Array allocation</li>
<li>Interpolate initial conditions to model vertical grid</li>
<li>Read external physics configuration namelist</li>
<li>Follow standalone driver procedure<ul>
<li>call gfuncphys to initialize physics lookup tables, etc.</li>
<li>call nuopc_phys_init with parameters read in from namelist</li>
<li>call "set" routines for NEMS derived data types needed by radiation</li>
<li>call nuopc_rad_update and nuopc_rad_run to calculate radiation</li>
<li>call "set" routines for NEMS derived data types needed by remainder of physics</li>
<li>call nuopc_phys_run to calculate remainder of physics </li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="detailed"></a>
Detailed Algorithm</h1>
</div><h2 class="groupheader">Function/Subroutine Documentation</h2>
<a class="anchor" id="af2e62134ed0a98729f7dbc2d5753e547"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine gmtb_scm_main::gmtb_scm_main_sub </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>case-specific initialization and forcing variables</p>
<p>reference profile variables</p>
<p>SCM state variables (variables with appended "i" are interface; variables with appended "l" are layer centered) index order for grid is (horizontal, vertical); index order for state variables is (horizontal, vertical, timesteps); index order for tracer is (horizontal, vertical, tracer_index, timesteps)</p>
<p>interpolated forcing variables</p>
<p>grid coefficients from file</p>
<p>The rest of the variables declared here are from the standalone driver</p>
<p>get_config returns the basic model configuration variables (file or command line)</p>
<p>get_case_init reads and returns case input data</p>
<p>get_reference_profile returns a reference profile to use above the case profile</p>
<p>set up the vertical grid based on the host model (in GFS case, there are also logical flags that set the type of vertical grid)</p>
<p>set up time scheme and number of time steps to keep</p>
<p>once all dimensions are known, allocate the necessary arrays</p>
<p>set_state interpolates the case input data to the model grid and patches in the reference sounding above the case data as necessary</p>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000001">Todo:</a></b></dt><dd>need to convert w_ls to omega and pass it into state_fldin (is pointer) </dd></dl>

<p>Definition at line <a class="el" href="gmtb__scm_8f90_source.html#l00079">79</a> of file <a class="el" href="gmtb__scm_8f90_source.html">gmtb_scm.f90</a>.</p>

<p>References <a class="el" href="gmtb__scm__vgrid_8f90_source.html#l00106">gmtb_scm_vgrid::calc_gfs_pres_and_exner()</a>, <a class="el" href="gmtb__scm__utils_8f90_source.html#l00021">gmtb_scm_utils::copy_data_to_working_dir()</a>, <a class="el" href="gmtb__scm__input_8f90_source.html#l00144">gmtb_scm_input::get_case_init()</a>, <a class="el" href="gmtb__scm__input_8f90_source.html#l00030">gmtb_scm_input::get_config()</a>, <a class="el" href="gmtb__scm__vgrid_8f90_source.html#l00024">gmtb_scm_vgrid::get_gfs_vgrid()</a>, <a class="el" href="gmtb__scm__input_8f90_source.html#l00267">gmtb_scm_input::get_reference_profile()</a>, <a class="el" href="gmtb__scm__forcing_8f90_source.html#l00023">gmtb_scm_forcing::interpolate_forcing()</a>, <a class="el" href="gmtb__scm__output_8f90_source.html#l00094">gmtb_scm_output::output_append()</a>, <a class="el" href="gmtb__scm__output_8f90_source.html#l00021">gmtb_scm_output::output_init()</a>, <a class="el" href="gmtb__scm__utils_8f90_source.html#l00030">gmtb_scm_utils::remove_data_from_working_dir()</a>, and <a class="el" href="gmtb__scm__setup_8f90_source.html#l00025">gmtb_scm_setup::set_state()</a>.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="namespacegmtb__scm__main.html">gmtb_scm_main</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.12 </li>
  </ul>
</div>
</body>
</html>
