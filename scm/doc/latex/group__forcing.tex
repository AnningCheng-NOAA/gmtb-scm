\hypertarget{group__forcing}{}\section{gmtb\+\_\+scm\+\_\+forcing}
\label{group__forcing}\index{gmtb\+\_\+scm\+\_\+forcing@{gmtb\+\_\+scm\+\_\+forcing}}


Contains subroutines to handle the S\+CM forcing -- interpolating in space and time, etc.  


\begin{DoxyCompactItemize}
\item 
subroutine \hyperlink{group__forcing_gaee4d8a92d081863df4499f2e1dce82bd}{gmtb\+\_\+scm\+\_\+forcing\+::interpolate\+\_\+forcing} (input\+\_\+ntimes, input\+\_\+nlev, input\+\_\+w\+\_\+ls, input\+\_\+omega, input\+\_\+u\+\_\+g, input\+\_\+v\+\_\+g, input\+\_\+u\+\_\+nudge,           input\+\_\+v\+\_\+nudge, input\+\_\+\+T\+\_\+nudge, input\+\_\+thil\+\_\+nudge, input\+\_\+qt\+\_\+nudge, input\+\_\+d\+T\+\_\+dt\+\_\+rad, input\+\_\+h\+\_\+advec\+\_\+thetail, input\+\_\+h\+\_\+advec\+\_\+qt,           input\+\_\+v\+\_\+advec\+\_\+thetail, input\+\_\+v\+\_\+advec\+\_\+qt, input\+\_\+pres, input\+\_\+time, input\+\_\+lat, input\+\_\+lon, input\+\_\+pres\+\_\+surf, input\+\_\+\+T\+\_\+surf, n\+\_\+levels,       n\+\_\+columns, grid\+\_\+pres, model\+\_\+time, w\+\_\+ls, omega, u\+\_\+g, v\+\_\+g, u\+\_\+nudge, v\+\_\+nudge, T\+\_\+nudge, thil\+\_\+nudge, qt\+\_\+nudge, d\+T\+\_\+dt\+\_\+rad,           h\+\_\+advec\+\_\+thil, h\+\_\+advec\+\_\+qt, v\+\_\+advec\+\_\+thil, v\+\_\+advec\+\_\+qt, lat, lon, pres\+\_\+surf, T\+\_\+surf)
\begin{DoxyCompactList}\small\item\em This subroutine interpolates the model forcing, column position, and surface properties to the current model time and to the model grid. \end{DoxyCompactList}\end{DoxyCompactItemize}
\begin{DoxyCompactItemize}
\item 
subroutine \hyperlink{group__forcing_gaa9a429a52d986be1bc2458f56e8f77aa}{gmtb\+\_\+scm\+\_\+forcing\+::apply\+\_\+forcing\+\_\+leapfrog} (n\+\_\+levels, n\+\_\+columns, state\+\_\+tracer, state\+\_\+T, state\+\_\+u, state\+\_\+v, w\+\_\+ls, omega, u\+\_\+g, v\+\_\+g, u\+\_\+nudge,   v\+\_\+nudge, T\+\_\+nudge, thil\+\_\+nudge, qt\+\_\+nudge, d\+T\+\_\+dt\+\_\+rad, h\+\_\+advec\+\_\+thil, h\+\_\+advec\+\_\+qt, v\+\_\+advec\+\_\+thil, v\+\_\+advec\+\_\+qt, exner\+\_\+l, phii, pres\+\_\+l,   lat, dt, thermo\+\_\+forcing\+\_\+type, mom\+\_\+forcing\+\_\+type, relax\+\_\+time, u\+\_\+force\+\_\+tend, v\+\_\+force\+\_\+tend, T\+\_\+force\+\_\+tend, qv\+\_\+force\+\_\+tend)
\begin{DoxyCompactList}\small\item\em This subroutine updates the state variables due to the model forcing using the leapfrog time integration scheme. It overwrites the state variable arrays where the filtered values from the previous time step are kept. These parts of the state variable arrays are pointed to by the state\+\_\+fields\+\_\+in D\+DT and are later updated by calling nuopc\+\_\+phys\+\_\+run. \end{DoxyCompactList}\end{DoxyCompactItemize}
\begin{DoxyCompactItemize}
\item 
subroutine \hyperlink{group__forcing_ga9f9e7db891365f55c3ce79e70a8fe580}{gmtb\+\_\+scm\+\_\+forcing\+::apply\+\_\+forcing\+\_\+forward\+\_\+euler} (n\+\_\+levels, n\+\_\+columns, state\+\_\+tracer, state\+\_\+T, state\+\_\+u, state\+\_\+v, w\+\_\+ls, omega, u\+\_\+g, v\+\_\+g,   u\+\_\+nudge, v\+\_\+nudge, T\+\_\+nudge, thil\+\_\+nudge, qt\+\_\+nudge, d\+T\+\_\+dt\+\_\+rad, h\+\_\+advec\+\_\+thil, h\+\_\+advec\+\_\+qt, v\+\_\+advec\+\_\+thil, v\+\_\+advec\+\_\+qt, exner\+\_\+l, phii,   pres\+\_\+l, lat, dt, thermo\+\_\+forcing\+\_\+type, mom\+\_\+forcing\+\_\+type, relax\+\_\+time, u\+\_\+force\+\_\+tend, v\+\_\+force\+\_\+tend, T\+\_\+force\+\_\+tend, qv\+\_\+force\+\_\+tend)
\end{DoxyCompactItemize}


\subsection{Detailed Description}
Contains subroutines to handle the S\+CM forcing -- interpolating in space and time, etc. 



\subsection{Function/\+Subroutine Documentation}
\index{gmtb\+\_\+scm\+\_\+forcing@{gmtb\+\_\+scm\+\_\+forcing}!apply\+\_\+forcing\+\_\+forward\+\_\+euler@{apply\+\_\+forcing\+\_\+forward\+\_\+euler}}
\index{apply\+\_\+forcing\+\_\+forward\+\_\+euler@{apply\+\_\+forcing\+\_\+forward\+\_\+euler}!gmtb\+\_\+scm\+\_\+forcing@{gmtb\+\_\+scm\+\_\+forcing}}
\subsubsection[{\texorpdfstring{apply\+\_\+forcing\+\_\+forward\+\_\+euler(n\+\_\+levels, n\+\_\+columns, state\+\_\+tracer, state\+\_\+\+T, state\+\_\+u, state\+\_\+v, w\+\_\+ls, omega, u\+\_\+g, v\+\_\+g,   u\+\_\+nudge, v\+\_\+nudge, T\+\_\+nudge, thil\+\_\+nudge, qt\+\_\+nudge, d\+T\+\_\+dt\+\_\+rad, h\+\_\+advec\+\_\+thil, h\+\_\+advec\+\_\+qt, v\+\_\+advec\+\_\+thil, v\+\_\+advec\+\_\+qt, exner\+\_\+l, phii,   pres\+\_\+l, lat, dt, thermo\+\_\+forcing\+\_\+type, mom\+\_\+forcing\+\_\+type, relax\+\_\+time, u\+\_\+force\+\_\+tend, v\+\_\+force\+\_\+tend, T\+\_\+force\+\_\+tend, qv\+\_\+force\+\_\+tend)}{apply_forcing_forward_euler(n_levels, n_columns, state_tracer, state_T, state_u, state_v, w_ls, omega, u_g, v_g,   u_nudge, v_nudge, T_nudge, thil_nudge, qt_nudge, dT_dt_rad, h_advec_thil, h_advec_qt, v_advec_thil, v_advec_qt, exner_l, phii,   pres_l, lat, dt, thermo_forcing_type, mom_forcing_type, relax_time, u_force_tend, v_force_tend, T_force_tend, qv_force_tend)}}]{\setlength{\rightskip}{0pt plus 5cm}subroutine gmtb\+\_\+scm\+\_\+forcing\+::apply\+\_\+forcing\+\_\+forward\+\_\+euler (
\begin{DoxyParamCaption}
\item[{integer, intent(in)}]{n\+\_\+levels, }
\item[{integer, intent(in)}]{n\+\_\+columns, }
\item[{real(kind=dp), dimension(\+:,\+:,\+:,\+:), intent(inout)}]{state\+\_\+tracer, }
\item[{real(kind=dp), dimension(\+:,\+:,\+:), intent(inout)}]{state\+\_\+T, }
\item[{real(kind=dp), dimension(\+:,\+:,\+:), intent(inout)}]{state\+\_\+u, }
\item[{real(kind=dp), dimension(\+:,\+:,\+:), intent(inout)}]{state\+\_\+v, }
\item[{real(kind=dp), dimension(\+:,\+:), intent(in)}]{w\+\_\+ls, }
\item[{real(kind=dp), dimension(\+:,\+:), intent(in)}]{omega, }
\item[{real(kind=dp), dimension(\+:,\+:), intent(in)}]{u\+\_\+g, }
\item[{real(kind=dp), dimension(\+:,\+:), intent(in)}]{v\+\_\+g, }
\item[{real(kind=dp), dimension(\+:,\+:), intent(in)}]{u\+\_\+nudge, }
\item[{real(kind=dp), dimension(\+:,\+:), intent(in)}]{v\+\_\+nudge, }
\item[{real(kind=dp), dimension(\+:,\+:), intent(in)}]{T\+\_\+nudge, }
\item[{real(kind=dp), dimension(\+:,\+:), intent(in)}]{thil\+\_\+nudge, }
\item[{real(kind=dp), dimension(\+:,\+:), intent(in)}]{qt\+\_\+nudge, }
\item[{real(kind=dp), dimension(\+:,\+:), intent(in)}]{d\+T\+\_\+dt\+\_\+rad, }
\item[{real(kind=dp), dimension(\+:,\+:), intent(in)}]{h\+\_\+advec\+\_\+thil, }
\item[{real(kind=dp), dimension(\+:,\+:), intent(in)}]{h\+\_\+advec\+\_\+qt, }
\item[{real(kind=dp), dimension(\+:,\+:), intent(in)}]{v\+\_\+advec\+\_\+thil, }
\item[{real(kind=dp), dimension(\+:,\+:), intent(in)}]{v\+\_\+advec\+\_\+qt, }
\item[{real(kind=dp), dimension(\+:,\+:), intent(in)}]{exner\+\_\+l, }
\item[{real(kind=dp), dimension(\+:,\+:), intent(in)}]{phii, }
\item[{real(kind=dp), dimension(\+:,\+:), intent(in)}]{pres\+\_\+l, }
\item[{real(kind=dp), dimension(\+:), intent(in)}]{lat, }
\item[{real(kind=dp), intent(in)}]{dt, }
\item[{integer, intent(in)}]{thermo\+\_\+forcing\+\_\+type, }
\item[{integer, intent(in)}]{mom\+\_\+forcing\+\_\+type, }
\item[{real(kind=dp), intent(in)}]{relax\+\_\+time, }
\item[{real(kind=dp), dimension(\+:,\+:), intent(out)}]{u\+\_\+force\+\_\+tend, }
\item[{real(kind=dp), dimension(\+:,\+:), intent(out)}]{v\+\_\+force\+\_\+tend, }
\item[{real(kind=dp), dimension(\+:,\+:), intent(out)}]{T\+\_\+force\+\_\+tend, }
\item[{real(kind=dp), dimension(\+:,\+:), intent(out)}]{qv\+\_\+force\+\_\+tend}
\end{DoxyParamCaption}
)}\hypertarget{group__forcing_ga9f9e7db891365f55c3ce79e70a8fe580}{}\label{group__forcing_ga9f9e7db891365f55c3ce79e70a8fe580}

\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em n\+\_\+columns} & number of model columns\\
\hline
\mbox{\tt in}  & {\em n\+\_\+levels} & number of model levels\\
\hline
\mbox{\tt in,out}  & {\em state\+\_\+tracer} & model state tracers (horizontal, vertical, tracer, iteration)\\
\hline
\mbox{\tt in,out}  & {\em state\+\_\+t} & model state temperature (horizontal, vertical, iteration)\\
\hline
\mbox{\tt in,out}  & {\em state\+\_\+u} & model state zonal wind (horizontal, vertical, iteration)\\
\hline
\mbox{\tt in,out}  & {\em state\+\_\+v} & model state meridional wind (horizontal, vertical, iteration)\\
\hline
\mbox{\tt in}  & {\em w\+\_\+ls} & large scale w (m/s) (horizontal, vertical)\\
\hline
\mbox{\tt in}  & {\em omega} & large scale pressure velocity (Pa/s) (horizontal, vertical)\\
\hline
\mbox{\tt in}  & {\em u\+\_\+g} & geostrophic zonal wind (m/s) (horizontal, vertical)\\
\hline
\mbox{\tt in}  & {\em v\+\_\+g} & geostrophic meridional wind (m/s) (horizontal, vertical)\\
\hline
\mbox{\tt in}  & {\em u\+\_\+nudge} & nudging zonal wind (m/s) (horizontal, vertical)\\
\hline
\mbox{\tt in}  & {\em v\+\_\+nudge} & nudging meridional wind (m/s) (horizontal, vertical)\\
\hline
\mbox{\tt in}  & {\em t\+\_\+nudge} & nudging abs. temperatuere (K) (horizontal, vertical)\\
\hline
\mbox{\tt in}  & {\em thil\+\_\+nudge} & nudging liq. pot. temperature (K) (horizontal, vertical)\\
\hline
\mbox{\tt in}  & {\em qt\+\_\+nudge} & nudging specific humidity (kg/kg) (horizontal, vertical)\\
\hline
\mbox{\tt in}  & {\em dt\+\_\+dt\+\_\+rad} & radiative heating rate (K/s) (horizontal, vertical)\\
\hline
\mbox{\tt in}  & {\em h\+\_\+advec\+\_\+thil} & change in theta\+\_\+il due to horizontal advection (K/s) (horizontal, vertical)\\
\hline
\mbox{\tt in}  & {\em h\+\_\+advec\+\_\+qt} & change in q\+\_\+t due to horizontal advection (kg/kg /s) (horizontal, vertical)\\
\hline
\mbox{\tt in}  & {\em v\+\_\+advec\+\_\+thil} & change in theta\+\_\+il due to vertical advection (K/s) (horizontal, vertical)\\
\hline
\mbox{\tt in}  & {\em v\+\_\+advec\+\_\+qt} & change in q\+\_\+t due to vertical advection (kg/kg /s) (horizontal, vertical)\\
\hline
\mbox{\tt in}  & {\em dt} & time step (s)\\
\hline
\mbox{\tt in}  & {\em lat} & latitude in radians\\
\hline
\mbox{\tt in}  & {\em exner\+\_\+l} & exner function at model level centers (horizontal, vertical)\\
\hline
\mbox{\tt in}  & {\em phii} & geopotential at model level interfaces (horizontal, vertical)\\
\hline
\mbox{\tt in}  & {\em pres\+\_\+l} & pressure at model level centers (horizontal, vertical)\\
\hline
\mbox{\tt in}  & {\em thermo\+\_\+forcing\+\_\+type} & 1\+: \char`\"{}revealed forcing\char`\"{}, 2\+: \char`\"{}horizontal advective forcing\char`\"{}, 3\+: \char`\"{}relaxation forcing\char`\"{}\\
\hline
\mbox{\tt in}  & {\em mom\+\_\+forcing\+\_\+type} & 1\+: \char`\"{}revealed forcing\char`\"{}, 2\+: \char`\"{}horizontal advective forcing\char`\"{}, 3\+: \char`\"{}relaxation forcing\char`\"{}\\
\hline
\mbox{\tt in}  & {\em relax\+\_\+time} & time scale for hor. wind nudging\\
\hline
\mbox{\tt out}  & {\em u\+\_\+force\+\_\+tend} & sum of all forcing for zonal momentum (horizontal, vertical)\\
\hline
\mbox{\tt out}  & {\em v\+\_\+force\+\_\+tend} & sum of all forcing for meridional momentum (horizontal, vertical)\\
\hline
\mbox{\tt out}  & {\em t\+\_\+force\+\_\+tend} & sum of all forcing for temperature (horizontal, vertical)\\
\hline
\mbox{\tt out}  & {\em qv\+\_\+force\+\_\+tend} & sum of all forcing for water vapor (horizontal, vertical) \\
\hline
\end{DoxyParams}
\hypertarget{group__forcing_apply_leapfrog_forcing_alg}{}\subsection{Algorithm}\label{group__forcing_apply_leapfrog_forcing_alg}

\begin{DoxyItemize}
\item Save old state variables (filtered from previous time step)
\item Initialize forcing sums to zero.
\begin{DoxyItemize}
\item Calculate w\+\_\+ls and z (height) at model layer interfaces.
\end{DoxyItemize}
\item Calculate change in state momentum variables due to vertical advection (subsidence).
\begin{DoxyItemize}
\item Calculate tendencies due to vertical advection using same discretization as in previous G\+FS S\+CM implmentation (staggered central difference) \[ \frac{\partial x}{\partial t}|_{vert. advection} = \frac{w_{k+1}\left(x_{k+1} - x_{k}\right) + w_k\left(x_k - x_{k-1}\right)}{-2\left(z_{k+1}-z_{k}\right)} \] where $w$ is the vertical velocity on interface levels, $x$ is some state variable on grid centers, $z$ is the height of interface levels. An model layer shares the same index as the interface below.
\item Handle the top and bottom levels separately using special discretizations.
\end{DoxyItemize}
\item Add forcing due to geostrophic wind
\begin{DoxyItemize}
\item Calculate Coriolis parameter.
\end{DoxyItemize}
\item Calculate change in state momentum variables due to nudging.
\item Add forcing due to prescribed radiation and horizontal advection
\item Add forcing due to prescribed radiation and horizontal advection
\item Calculate change in state temperature/moisture variables due to nudging.
\item Update the state variables using the forward Euler scheme\+: \[ x^{\tau + 1} = x^{\tau} + \Delta t\frac{\partial x}{\partial t}|^\tau_{forcing} \] $x^{\tau}$ is the value at the previous time step and $\frac{\partial x}{\partial t}|^\tau_{forcing}$ is the sum of forcing terms calculated in this time step.
\end{DoxyItemize}

Definition at line 571 of file gmtb\+\_\+scm\+\_\+forcing.\+f90.



Referenced by gmtb\+\_\+scm\+\_\+time\+\_\+integration\+::do\+\_\+time\+\_\+step().

\index{gmtb\+\_\+scm\+\_\+forcing@{gmtb\+\_\+scm\+\_\+forcing}!apply\+\_\+forcing\+\_\+leapfrog@{apply\+\_\+forcing\+\_\+leapfrog}}
\index{apply\+\_\+forcing\+\_\+leapfrog@{apply\+\_\+forcing\+\_\+leapfrog}!gmtb\+\_\+scm\+\_\+forcing@{gmtb\+\_\+scm\+\_\+forcing}}
\subsubsection[{\texorpdfstring{apply\+\_\+forcing\+\_\+leapfrog(n\+\_\+levels, n\+\_\+columns, state\+\_\+tracer, state\+\_\+\+T, state\+\_\+u, state\+\_\+v, w\+\_\+ls, omega, u\+\_\+g, v\+\_\+g, u\+\_\+nudge,   v\+\_\+nudge, T\+\_\+nudge, thil\+\_\+nudge, qt\+\_\+nudge, d\+T\+\_\+dt\+\_\+rad, h\+\_\+advec\+\_\+thil, h\+\_\+advec\+\_\+qt, v\+\_\+advec\+\_\+thil, v\+\_\+advec\+\_\+qt, exner\+\_\+l, phii, pres\+\_\+l,   lat, dt, thermo\+\_\+forcing\+\_\+type, mom\+\_\+forcing\+\_\+type, relax\+\_\+time, u\+\_\+force\+\_\+tend, v\+\_\+force\+\_\+tend, T\+\_\+force\+\_\+tend, qv\+\_\+force\+\_\+tend)}{apply_forcing_leapfrog(n_levels, n_columns, state_tracer, state_T, state_u, state_v, w_ls, omega, u_g, v_g, u_nudge,   v_nudge, T_nudge, thil_nudge, qt_nudge, dT_dt_rad, h_advec_thil, h_advec_qt, v_advec_thil, v_advec_qt, exner_l, phii, pres_l,   lat, dt, thermo_forcing_type, mom_forcing_type, relax_time, u_force_tend, v_force_tend, T_force_tend, qv_force_tend)}}]{\setlength{\rightskip}{0pt plus 5cm}subroutine gmtb\+\_\+scm\+\_\+forcing\+::apply\+\_\+forcing\+\_\+leapfrog (
\begin{DoxyParamCaption}
\item[{integer, intent(in)}]{n\+\_\+levels, }
\item[{integer, intent(in)}]{n\+\_\+columns, }
\item[{real(kind=dp), dimension(\+:,\+:,\+:,\+:), intent(inout)}]{state\+\_\+tracer, }
\item[{real(kind=dp), dimension(\+:,\+:,\+:), intent(inout)}]{state\+\_\+T, }
\item[{real(kind=dp), dimension(\+:,\+:,\+:), intent(inout)}]{state\+\_\+u, }
\item[{real(kind=dp), dimension(\+:,\+:,\+:), intent(inout)}]{state\+\_\+v, }
\item[{real(kind=dp), dimension(\+:,\+:), intent(in)}]{w\+\_\+ls, }
\item[{real(kind=dp), dimension(\+:,\+:), intent(in)}]{omega, }
\item[{real(kind=dp), dimension(\+:,\+:), intent(in)}]{u\+\_\+g, }
\item[{real(kind=dp), dimension(\+:,\+:), intent(in)}]{v\+\_\+g, }
\item[{real(kind=dp), dimension(\+:,\+:), intent(in)}]{u\+\_\+nudge, }
\item[{real(kind=dp), dimension(\+:,\+:), intent(in)}]{v\+\_\+nudge, }
\item[{real(kind=dp), dimension(\+:,\+:), intent(in)}]{T\+\_\+nudge, }
\item[{real(kind=dp), dimension(\+:,\+:), intent(in)}]{thil\+\_\+nudge, }
\item[{real(kind=dp), dimension(\+:,\+:), intent(in)}]{qt\+\_\+nudge, }
\item[{real(kind=dp), dimension(\+:,\+:), intent(in)}]{d\+T\+\_\+dt\+\_\+rad, }
\item[{real(kind=dp), dimension(\+:,\+:), intent(in)}]{h\+\_\+advec\+\_\+thil, }
\item[{real(kind=dp), dimension(\+:,\+:), intent(in)}]{h\+\_\+advec\+\_\+qt, }
\item[{real(kind=dp), dimension(\+:,\+:), intent(in)}]{v\+\_\+advec\+\_\+thil, }
\item[{real(kind=dp), dimension(\+:,\+:), intent(in)}]{v\+\_\+advec\+\_\+qt, }
\item[{real(kind=dp), dimension(\+:,\+:), intent(in)}]{exner\+\_\+l, }
\item[{real(kind=dp), dimension(\+:,\+:), intent(in)}]{phii, }
\item[{real(kind=dp), dimension(\+:,\+:), intent(in)}]{pres\+\_\+l, }
\item[{real(kind=dp), dimension(\+:), intent(in)}]{lat, }
\item[{real(kind=dp), intent(in)}]{dt, }
\item[{integer, intent(in)}]{thermo\+\_\+forcing\+\_\+type, }
\item[{integer, intent(in)}]{mom\+\_\+forcing\+\_\+type, }
\item[{real(kind=dp), intent(in)}]{relax\+\_\+time, }
\item[{real(kind=dp), dimension(\+:,\+:), intent(out)}]{u\+\_\+force\+\_\+tend, }
\item[{real(kind=dp), dimension(\+:,\+:), intent(out)}]{v\+\_\+force\+\_\+tend, }
\item[{real(kind=dp), dimension(\+:,\+:), intent(out)}]{T\+\_\+force\+\_\+tend, }
\item[{real(kind=dp), dimension(\+:,\+:), intent(out)}]{qv\+\_\+force\+\_\+tend}
\end{DoxyParamCaption}
)}\hypertarget{group__forcing_gaa9a429a52d986be1bc2458f56e8f77aa}{}\label{group__forcing_gaa9a429a52d986be1bc2458f56e8f77aa}


This subroutine updates the state variables due to the model forcing using the leapfrog time integration scheme. It overwrites the state variable arrays where the filtered values from the previous time step are kept. These parts of the state variable arrays are pointed to by the state\+\_\+fields\+\_\+in D\+DT and are later updated by calling nuopc\+\_\+phys\+\_\+run. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em n\+\_\+columns} & number of model columns\\
\hline
\mbox{\tt in}  & {\em n\+\_\+levels} & number of model levels\\
\hline
\mbox{\tt in,out}  & {\em state\+\_\+tracer} & model state tracers (horizontal, vertical, tracer, iteration)\\
\hline
\mbox{\tt in,out}  & {\em state\+\_\+t} & model state temperature (horizontal, vertical, iteration)\\
\hline
\mbox{\tt in,out}  & {\em state\+\_\+u} & model state zonal wind (horizontal, vertical, iteration)\\
\hline
\mbox{\tt in,out}  & {\em state\+\_\+v} & model state meridional wind (horizontal, vertical, iteration)\\
\hline
\mbox{\tt in}  & {\em w\+\_\+ls} & large scale w (m/s) (horizontal, vertical)\\
\hline
\mbox{\tt in}  & {\em omega} & large scale pressure velocity (Pa/s) (horizontal, vertical)\\
\hline
\mbox{\tt in}  & {\em u\+\_\+g} & geostrophic zonal wind (m/s) (horizontal, vertical)\\
\hline
\mbox{\tt in}  & {\em v\+\_\+g} & geostrophic meridional wind (m/s) (horizontal, vertical)\\
\hline
\mbox{\tt in}  & {\em u\+\_\+nudge} & nudging zonal wind (m/s) (horizontal, vertical)\\
\hline
\mbox{\tt in}  & {\em v\+\_\+nudge} & nudging meridional wind (m/s) (horizontal, vertical)\\
\hline
\mbox{\tt in}  & {\em t\+\_\+nudge} & nudging abs. temperatuere (K) (horizontal, vertical)\\
\hline
\mbox{\tt in}  & {\em thil\+\_\+nudge} & nudging liq. pot. temperature (K) (horizontal, vertical)\\
\hline
\mbox{\tt in}  & {\em qt\+\_\+nudge} & nudging specific humidity (kg/kg) (horizontal, vertical)\\
\hline
\mbox{\tt in}  & {\em dt\+\_\+dt\+\_\+rad} & radiative heating rate (K/s) (horizontal, vertical)\\
\hline
\mbox{\tt in}  & {\em h\+\_\+advec\+\_\+thil} & change in theta\+\_\+il due to horizontal advection (K/s) (horizontal, vertical)\\
\hline
\mbox{\tt in}  & {\em h\+\_\+advec\+\_\+qt} & change in q\+\_\+t due to horizontal advection (kg/kg /s) (horizontal, vertical)\\
\hline
\mbox{\tt in}  & {\em v\+\_\+advec\+\_\+thil} & change in theta\+\_\+il due to vertical advection (K/s) (horizontal, vertical)\\
\hline
\mbox{\tt in}  & {\em v\+\_\+advec\+\_\+qt} & change in q\+\_\+t due to vertical advection (kg/kg /s) (horizontal, vertical)\\
\hline
\mbox{\tt in}  & {\em dt} & time step (s)\\
\hline
\mbox{\tt in}  & {\em lat} & latitude in radians\\
\hline
\mbox{\tt in}  & {\em exner\+\_\+l} & exner function at model level centers (horizontal, vertical)\\
\hline
\mbox{\tt in}  & {\em phii} & geopotential at model level interfaces (horizontal, vertical)\\
\hline
\mbox{\tt in}  & {\em pres\+\_\+l} & pressure at model level centers (horizontal, vertical)\\
\hline
\mbox{\tt in}  & {\em thermo\+\_\+forcing\+\_\+type} & 1\+: \char`\"{}revealed forcing\char`\"{}, 2\+: \char`\"{}horizontal advective forcing\char`\"{}, 3\+: \char`\"{}relaxation forcing\char`\"{}\\
\hline
\mbox{\tt in}  & {\em mom\+\_\+forcing\+\_\+type} & 1\+: \char`\"{}revealed forcing\char`\"{}, 2\+: \char`\"{}horizontal advective forcing\char`\"{}, 3\+: \char`\"{}relaxation forcing\char`\"{}\\
\hline
\mbox{\tt in}  & {\em relax\+\_\+time} & time scale for hor. wind nudging\\
\hline
\mbox{\tt out}  & {\em u\+\_\+force\+\_\+tend} & sum of all forcing for zonal momentum (horizontal, vertical)\\
\hline
\mbox{\tt out}  & {\em v\+\_\+force\+\_\+tend} & sum of all forcing for meridional momentum (horizontal, vertical)\\
\hline
\mbox{\tt out}  & {\em t\+\_\+force\+\_\+tend} & sum of all forcing for temperature (horizontal, vertical)\\
\hline
\mbox{\tt out}  & {\em qv\+\_\+force\+\_\+tend} & sum of all forcing for water vapor (horizontal, vertical) \\
\hline
\end{DoxyParams}
\hypertarget{group__forcing_apply_leapfrog_forcing_alg}{}\subsection{Algorithm}\label{group__forcing_apply_leapfrog_forcing_alg}

\begin{DoxyItemize}
\item Save old state variables (filtered from previous time step)
\item Initialize forcing sums to zero.
\begin{DoxyItemize}
\item Calculate w\+\_\+ls and z (height) at model layer interfaces.
\end{DoxyItemize}
\item Calculate change in state momentum variables due to vertical advection (subsidence).
\begin{DoxyItemize}
\item Calculate tendencies due to vertical advection using same discretization as in previous G\+FS S\+CM implmentation (staggered central difference) \[ \frac{\partial x}{\partial t}|_{vert. advection} = \frac{w_{k+1}\left(x_{k+1} - x_{k}\right) + w_k\left(x_k - x_{k-1}\right)}{-2\left(z_{k+1}-z_{k}\right)} \] where $w$ is the vertical velocity on interface levels, $x$ is some state variable on grid centers, $z$ is the height of interface levels. An model layer shares the same index as the interface below.
\item Handle the top and bottom levels separately using special discretizations.
\end{DoxyItemize}
\item Add forcing due to geostrophic wind
\begin{DoxyItemize}
\item Calculate Coriolis parameter.
\end{DoxyItemize}
\item Calculate change in state momentum variables due to nudging.
\item Add forcing due to prescribed radiation and horizontal advection
\item Add forcing due to prescribed radiation and horizontal advection
\item Calculate change in state temperature/moisture variables due to nudging.
\item Update the state variables using the leapfrog scheme\+: \[ x^{\tau + 1} = \overline{x^{\tau - 1}} + 2\Delta t\frac{\partial x}{\partial t}|^\tau_{forcing} \] $\overline{x^{\tau - 1}}$ is the filtered value at the previous time step and $\frac{\partial x}{\partial t}|^\tau_{forcing}$ is the sum of forcing terms calculated in this time step.
\end{DoxyItemize}

Definition at line 308 of file gmtb\+\_\+scm\+\_\+forcing.\+f90.



Referenced by gmtb\+\_\+scm\+\_\+time\+\_\+integration\+::do\+\_\+time\+\_\+step().

\index{gmtb\+\_\+scm\+\_\+forcing@{gmtb\+\_\+scm\+\_\+forcing}!interpolate\+\_\+forcing@{interpolate\+\_\+forcing}}
\index{interpolate\+\_\+forcing@{interpolate\+\_\+forcing}!gmtb\+\_\+scm\+\_\+forcing@{gmtb\+\_\+scm\+\_\+forcing}}
\subsubsection[{\texorpdfstring{interpolate\+\_\+forcing(input\+\_\+ntimes, input\+\_\+nlev, input\+\_\+w\+\_\+ls, input\+\_\+omega, input\+\_\+u\+\_\+g, input\+\_\+v\+\_\+g, input\+\_\+u\+\_\+nudge,           input\+\_\+v\+\_\+nudge, input\+\_\+\+T\+\_\+nudge, input\+\_\+thil\+\_\+nudge, input\+\_\+qt\+\_\+nudge, input\+\_\+d\+T\+\_\+dt\+\_\+rad, input\+\_\+h\+\_\+advec\+\_\+thetail, input\+\_\+h\+\_\+advec\+\_\+qt,           input\+\_\+v\+\_\+advec\+\_\+thetail, input\+\_\+v\+\_\+advec\+\_\+qt, input\+\_\+pres, input\+\_\+time, input\+\_\+lat, input\+\_\+lon, input\+\_\+pres\+\_\+surf, input\+\_\+\+T\+\_\+surf, n\+\_\+levels,       n\+\_\+columns, grid\+\_\+pres, model\+\_\+time, w\+\_\+ls, omega, u\+\_\+g, v\+\_\+g, u\+\_\+nudge, v\+\_\+nudge, T\+\_\+nudge, thil\+\_\+nudge, qt\+\_\+nudge, d\+T\+\_\+dt\+\_\+rad,           h\+\_\+advec\+\_\+thil, h\+\_\+advec\+\_\+qt, v\+\_\+advec\+\_\+thil, v\+\_\+advec\+\_\+qt, lat, lon, pres\+\_\+surf, T\+\_\+surf)}{interpolate_forcing(input_ntimes, input_nlev, input_w_ls, input_omega, input_u_g, input_v_g, input_u_nudge,           input_v_nudge, input_T_nudge, input_thil_nudge, input_qt_nudge, input_dT_dt_rad, input_h_advec_thetail, input_h_advec_qt,           input_v_advec_thetail, input_v_advec_qt, input_pres, input_time, input_lat, input_lon, input_pres_surf, input_T_surf, n_levels,       n_columns, grid_pres, model_time, w_ls, omega, u_g, v_g, u_nudge, v_nudge, T_nudge, thil_nudge, qt_nudge, dT_dt_rad,           h_advec_thil, h_advec_qt, v_advec_thil, v_advec_qt, lat, lon, pres_surf, T_surf)}}]{\setlength{\rightskip}{0pt plus 5cm}subroutine gmtb\+\_\+scm\+\_\+forcing\+::interpolate\+\_\+forcing (
\begin{DoxyParamCaption}
\item[{integer, intent(in)}]{input\+\_\+ntimes, }
\item[{integer, intent(in)}]{input\+\_\+nlev, }
\item[{real(kind=dp), dimension(\+:,\+:), intent(in)}]{input\+\_\+w\+\_\+ls, }
\item[{real(kind=dp), dimension(\+:,\+:), intent(in)}]{input\+\_\+omega, }
\item[{real(kind=dp), dimension(\+:,\+:), intent(in)}]{input\+\_\+u\+\_\+g, }
\item[{real(kind=dp), dimension(\+:,\+:), intent(in)}]{input\+\_\+v\+\_\+g, }
\item[{real(kind=dp), dimension(\+:,\+:), intent(in)}]{input\+\_\+u\+\_\+nudge, }
\item[{real(kind=dp), dimension(\+:,\+:), intent(in)}]{input\+\_\+v\+\_\+nudge, }
\item[{real(kind=dp), dimension(\+:,\+:), intent(in)}]{input\+\_\+\+T\+\_\+nudge, }
\item[{real(kind=dp), dimension(\+:,\+:), intent(in)}]{input\+\_\+thil\+\_\+nudge, }
\item[{real(kind=dp), dimension(\+:,\+:), intent(in)}]{input\+\_\+qt\+\_\+nudge, }
\item[{real(kind=dp), dimension(\+:,\+:), intent(in)}]{input\+\_\+d\+T\+\_\+dt\+\_\+rad, }
\item[{real(kind=dp), dimension(\+:,\+:), intent(in)}]{input\+\_\+h\+\_\+advec\+\_\+thetail, }
\item[{real(kind=dp), dimension(\+:,\+:), intent(in)}]{input\+\_\+h\+\_\+advec\+\_\+qt, }
\item[{real(kind=dp), dimension(\+:,\+:), intent(in)}]{input\+\_\+v\+\_\+advec\+\_\+thetail, }
\item[{real(kind=dp), dimension(\+:,\+:), intent(in)}]{input\+\_\+v\+\_\+advec\+\_\+qt, }
\item[{real(kind=dp), dimension(\+:), intent(in)}]{input\+\_\+pres, }
\item[{real(kind=dp), dimension(\+:), intent(in)}]{input\+\_\+time, }
\item[{real(kind=dp), dimension(\+:), intent(in)}]{input\+\_\+lat, }
\item[{real(kind=dp), dimension(\+:), intent(in)}]{input\+\_\+lon, }
\item[{real(kind=dp), dimension(\+:), intent(in)}]{input\+\_\+pres\+\_\+surf, }
\item[{real(kind=dp), dimension(\+:), intent(in)}]{input\+\_\+\+T\+\_\+surf, }
\item[{integer, intent(in)}]{n\+\_\+levels, }
\item[{integer, intent(in)}]{n\+\_\+columns, }
\item[{real(kind=dp), dimension(\+:,\+:), intent(in)}]{grid\+\_\+pres, }
\item[{real(kind=dp), intent(in)}]{model\+\_\+time, }
\item[{real(kind=dp), dimension(\+:,\+:), intent(out)}]{w\+\_\+ls, }
\item[{real(kind=dp), dimension(\+:,\+:), intent(out)}]{omega, }
\item[{real(kind=dp), dimension(\+:,\+:), intent(out)}]{u\+\_\+g, }
\item[{real(kind=dp), dimension(\+:,\+:), intent(out)}]{v\+\_\+g, }
\item[{real(kind=dp), dimension(\+:,\+:), intent(out)}]{u\+\_\+nudge, }
\item[{real(kind=dp), dimension(\+:,\+:), intent(out)}]{v\+\_\+nudge, }
\item[{real(kind=dp), dimension(\+:,\+:), intent(out)}]{T\+\_\+nudge, }
\item[{real(kind=dp), dimension(\+:,\+:), intent(out)}]{thil\+\_\+nudge, }
\item[{real(kind=dp), dimension(\+:,\+:), intent(out)}]{qt\+\_\+nudge, }
\item[{real(kind=dp), dimension(\+:,\+:), intent(out)}]{d\+T\+\_\+dt\+\_\+rad, }
\item[{real(kind=dp), dimension(\+:,\+:), intent(out)}]{h\+\_\+advec\+\_\+thil, }
\item[{real(kind=dp), dimension(\+:,\+:), intent(out)}]{h\+\_\+advec\+\_\+qt, }
\item[{real(kind=dp), dimension(\+:,\+:), intent(out)}]{v\+\_\+advec\+\_\+thil, }
\item[{real(kind=dp), dimension(\+:,\+:), intent(out)}]{v\+\_\+advec\+\_\+qt, }
\item[{real(kind=dp), dimension(\+:), intent(out)}]{lat, }
\item[{real(kind=dp), dimension(\+:), intent(out)}]{lon, }
\item[{real(kind=dp), dimension(\+:), intent(out)}]{pres\+\_\+surf, }
\item[{real(kind=dp), dimension(\+:), intent(out)}]{T\+\_\+surf}
\end{DoxyParamCaption}
)}\hypertarget{group__forcing_gaee4d8a92d081863df4499f2e1dce82bd}{}\label{group__forcing_gaee4d8a92d081863df4499f2e1dce82bd}


This subroutine interpolates the model forcing, column position, and surface properties to the current model time and to the model grid. 

\begin{DoxyNote}{Note}
The input forcing file contains forcing for one column, yet the S\+CM code can accommodate more than one column. Right now, all columns are assumed to have the same forcing.
\end{DoxyNote}

\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em input\+\_\+ntimes} & number of forcing profiles in the input file corresponding to changing forcing in time\\
\hline
\mbox{\tt in}  & {\em input\+\_\+nlev} & number of levels in each input forcing profile\\
\hline
\mbox{\tt in}  & {\em input\+\_\+w\+\_\+ls} & input large-\/scale w (m/s) (time, levels)\\
\hline
\mbox{\tt in}  & {\em input\+\_\+omega} & input large-\/scale omega (Pa/s) (time, levels)\\
\hline
\mbox{\tt in}  & {\em input\+\_\+u\+\_\+g} & input geostrophic zonal wind (m/s) (time, levels)\\
\hline
\mbox{\tt in}  & {\em input\+\_\+v\+\_\+g} & input geostrophic meridional wind (m/s) (time, levels)\\
\hline
\mbox{\tt in}  & {\em input\+\_\+u\+\_\+nudge} & input nudging zonal wind (m/s) (time, levels)\\
\hline
\mbox{\tt in}  & {\em input\+\_\+v\+\_\+nudge} & input nudging meridional wind (m/s) (time, levels)\\
\hline
\mbox{\tt in}  & {\em input\+\_\+t\+\_\+nudge} & input nudging abs. temperature (K)) (time, levels)\\
\hline
\mbox{\tt in}  & {\em input\+\_\+thil\+\_\+nudge} & input nudging liq. pot. temperature (K) (time, levels)\\
\hline
\mbox{\tt in}  & {\em input\+\_\+qt\+\_\+nudge} & input nudging specific humidity (kg/kg) (time, levels)\\
\hline
\mbox{\tt in}  & {\em input\+\_\+dt\+\_\+dt\+\_\+rad} & input radiative heating rate (K/s) (time, levels)\\
\hline
\mbox{\tt in}  & {\em input\+\_\+h\+\_\+advec\+\_\+thetail} & input change in theta\+\_\+il due to horizontal advection (K/s) (time, levels)\\
\hline
\mbox{\tt in}  & {\em input\+\_\+h\+\_\+advec\+\_\+qt} & input change in q\+\_\+t due to horizontal advection (kg/kg /s) (time, levels)\\
\hline
\mbox{\tt in}  & {\em input\+\_\+v\+\_\+advec\+\_\+thetail} & input change in theta\+\_\+il due to vertical advection (K/s) (time, levels)\\
\hline
\mbox{\tt in}  & {\em input\+\_\+v\+\_\+advec\+\_\+qt} & input change in q\+\_\+t due to vertical advection (kg/kg /s) (time, levels)\\
\hline
\mbox{\tt in}  & {\em input\+\_\+pres} & input pressure levels (Pa) (levels)\\
\hline
\mbox{\tt in}  & {\em input\+\_\+time} & input times (s) (time)\\
\hline
\mbox{\tt in}  & {\em input\+\_\+lat} & input latitude (degrees) (time)\\
\hline
\mbox{\tt in}  & {\em input\+\_\+lon} & input longitude (degrees) (time)\\
\hline
\mbox{\tt in}  & {\em input\+\_\+pres\+\_\+surf} & input surface pressure (Pa) (time)\\
\hline
\mbox{\tt in}  & {\em input\+\_\+t\+\_\+surf} & input surface temperature (K) (time)\\
\hline
\mbox{\tt in}  & {\em n\+\_\+levels} & number of model levels\\
\hline
\mbox{\tt in}  & {\em n\+\_\+columns} & number of model columns\\
\hline
\mbox{\tt in}  & {\em grid\+\_\+pres} & pressure at grid centers (Pa) (horizontal, vertical)\\
\hline
\mbox{\tt in}  & {\em model\+\_\+time} & current model elapsed time (s)\\
\hline
\mbox{\tt out}  & {\em w\+\_\+ls} & output large scale w (m/s) (horizontal, vertical)\\
\hline
\mbox{\tt out}  & {\em omega} & output large scale pressure velocity (Pa/s) (horizontal, vertical)\\
\hline
\mbox{\tt out}  & {\em u\+\_\+g} & output geostrophic zonal wind (m/s) (horizontal, vertical)\\
\hline
\mbox{\tt out}  & {\em v\+\_\+g} & output geostrophic meridional wind (m/s) (horizontal, vertical)\\
\hline
\mbox{\tt out}  & {\em u\+\_\+nudge} & output nudging zonal wind (m/s) (horizontal, vertical)\\
\hline
\mbox{\tt out}  & {\em v\+\_\+nudge} & output nudging meridional wind (m/s) (horizontal, vertical)\\
\hline
\mbox{\tt out}  & {\em t\+\_\+nudge} & output nudging abs. temperature (K) (horizontal, vertical)\\
\hline
\mbox{\tt out}  & {\em thil\+\_\+nudge} & output nudging liq. pot. temperature (K) (horizontal, vertical)\\
\hline
\mbox{\tt out}  & {\em qt\+\_\+nudge} & output nudging specific humidity (kg/kg) (horizontal, vertical)\\
\hline
\mbox{\tt out}  & {\em dt\+\_\+dt\+\_\+rad} & output radiative heating rate (K/s) (horizontal, vertical)\\
\hline
\mbox{\tt out}  & {\em h\+\_\+advec\+\_\+thil} & output change in theta\+\_\+il due to horizontal advection (K/s) (horizontal, vertical)\\
\hline
\mbox{\tt out}  & {\em h\+\_\+advec\+\_\+qt} & output change in q\+\_\+t due to horizontal advection (kg/kg /s) (horizontal, vertical)\\
\hline
\mbox{\tt out}  & {\em v\+\_\+advec\+\_\+thil} & output change in theta\+\_\+il due to vertical advection (K/s) (horizontal, vertical)\\
\hline
\mbox{\tt out}  & {\em v\+\_\+advec\+\_\+qt} & output change in q\+\_\+t due to vertical advection (kg/kg /s) (horizontal, vertical)\\
\hline
\mbox{\tt out}  & {\em lat} & output latitude (horizontal)\\
\hline
\mbox{\tt out}  & {\em lon} & output longitude (horizontal)\\
\hline
\mbox{\tt out}  & {\em pres\+\_\+surf} & output surface pressure (Pa) (horizontal)\\
\hline
\mbox{\tt out}  & {\em t\+\_\+surf} & output surface temperature (K) (horizontal) \\
\hline
\end{DoxyParams}
\hypertarget{group__forcing_interpolate_forcing_alg}{}\subsection{Algorithm}\label{group__forcing_interpolate_forcing_alg}

\begin{DoxyItemize}
\item Check for the case where the elapsed model time extends beyond the supplied forcing.
\begin{DoxyItemize}
\item If so, hold the forcing terms constant at the last supplied values. The forcing still needs to be interpolated to the grid.
\item For all forcing terms, call interpolate\+\_\+to\+\_\+grid\+\_\+centers from \hyperlink{group__utils}{gmtb\+\_\+scm\+\_\+utils} for each variable. This subroutine returns the last vertical index calculated in case forcing terms above the case input needs to be specified.
\item If the input forcing file does not reach to the model domain top, fill in values above the input forcing file domain with those from the top level.
\item For this case, no time interpolation is necessary; just set the forcing terms to the vertically-\/interpolated values.
\item Set the surface parameters to the last available data.
\item Convert lat, lon to radians.
\end{DoxyItemize}
\item When the model elapsed time is within the time-\/frame specified by the input forcing, the forcing must be interpolated in time and space.
\begin{DoxyItemize}
\item Determine the index in the input file for the time immediately preceeding the model time and determine the linear interpolation value.
\item For all forcing terms, call interpolate\+\_\+to\+\_\+grid\+\_\+centers from \hyperlink{group__utils}{gmtb\+\_\+scm\+\_\+utils} for each variable for each time level that \char`\"{}bracket\char`\"{} around the current model time. This subroutine returns the last vertical index calculated in case forcing terms above the case input needs to be specified.
\item If the input forcing file does not reach to the model domain top, fill in values above the input forcing file domain with those from the top level.
\item Interpolate the forcing terms in time.
\item Interpolate the surface parameters in time.
\item Convert lat, lon to radians.
\end{DoxyItemize}
\end{DoxyItemize}

Definition at line 28 of file gmtb\+\_\+scm\+\_\+forcing.\+f90.



References gmtb\+\_\+scm\+\_\+utils\+::interpolate\+\_\+to\+\_\+grid\+\_\+centers().



Referenced by gmtb\+\_\+scm\+\_\+main\+::gmtb\+\_\+scm\+\_\+main\+\_\+sub().

