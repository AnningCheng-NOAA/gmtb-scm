\hypertarget{group__time__integration}{}\section{gmtb\+\_\+scm\+\_\+time\+\_\+integration}
\label{group__time__integration}\index{gmtb\+\_\+scm\+\_\+time\+\_\+integration@{gmtb\+\_\+scm\+\_\+time\+\_\+integration}}


Contains subroutines to handle the S\+CM time stepping.  


\begin{DoxyCompactItemize}
\item 
subroutine \hyperlink{group__time__integration_gadc22247097920b209bb2c62f4dfe8f75}{gmtb\+\_\+scm\+\_\+time\+\_\+integration\+::filter} (c\+\_\+filter, temp\+\_\+tracer, temp\+\_\+T, temp\+\_\+u, temp\+\_\+v, state\+\_\+tracer, state\+\_\+T, state\+\_\+u, state\+\_\+v)
\begin{DoxyCompactList}\small\item\em This subroutine performs the Robert-\/\+Asselin time filtering of the state variables. \end{DoxyCompactList}\item 
subroutine \hyperlink{group__time__integration_ga32b72716e3e970874e9cb909ba66328d}{gmtb\+\_\+scm\+\_\+time\+\_\+integration\+::do\+\_\+time\+\_\+step} (n\+\_\+levels, n\+\_\+columns, time\+\_\+scheme, state\+\_\+fldin, state\+\_\+fldout, sfc\+\_\+prop, diags, intrfc\+\_\+fld, cld\+\_\+prop,   rad\+\_\+tend, mdl\+\_\+parm, tbddata, dyn\+\_\+parm, state\+\_\+tracer, state\+\_\+T, state\+\_\+u, state\+\_\+v, w\+\_\+ls, omega, u\+\_\+g, v\+\_\+g, u\+\_\+nudge, v\+\_\+nudge, T\+\_\+nudge, thil\+\_\+nudge, qt\+\_\+nudge, d\+T\+\_\+dt\+\_\+rad, h\+\_\+advec\+\_\+thil, h\+\_\+advec\+\_\+qt, v\+\_\+advec\+\_\+thil, v\+\_\+advec\+\_\+qt, u\+\_\+force\+\_\+tend, v\+\_\+force\+\_\+tend, T\+\_\+force\+\_\+tend,   qv\+\_\+force\+\_\+tend, exner\+\_\+l, phii, pres\+\_\+l, lat, dt, lsswr, lslwr, thermo\+\_\+forcing\+\_\+type, mom\+\_\+forcing\+\_\+type, relax\+\_\+time)
\begin{DoxyCompactList}\small\item\em This subroutine calls nuopc\+\_\+rad\+\_\+update and nuopc\+\_\+rad\+\_\+run in nuopc\+\_\+physics.\+F90 (if necessary) and apply\+\_\+forcing\+\_\+leapfrog from \hyperlink{group__forcing}{gmtb\+\_\+scm\+\_\+forcing} and nuopc\+\_\+phys\+\_\+run, also from nuopc\+\_\+physics.\+F90. The subroutine nuopc\+\_\+rad\+\_\+update calculates the time-\/dependent parameters required to run radiation, and nuopc\+\_\+rad\+\_\+run calculates the radiative heating rate (but does not apply it). The subroutine apply\+\_\+forcing\+\_\+leapfrog advances the state variables forward using the leapfrog method and nuopc\+\_\+phys\+\_\+run further changes the state variables using the forward method. By the end of this subroutine, the unfiltered state variables will have been stepped forward in time. \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Detailed Description}
Contains subroutines to handle the S\+CM time stepping. 



\subsection{Function/\+Subroutine Documentation}
\index{gmtb\+\_\+scm\+\_\+time\+\_\+integration@{gmtb\+\_\+scm\+\_\+time\+\_\+integration}!do\+\_\+time\+\_\+step@{do\+\_\+time\+\_\+step}}
\index{do\+\_\+time\+\_\+step@{do\+\_\+time\+\_\+step}!gmtb\+\_\+scm\+\_\+time\+\_\+integration@{gmtb\+\_\+scm\+\_\+time\+\_\+integration}}
\subsubsection[{\texorpdfstring{do\+\_\+time\+\_\+step(n\+\_\+levels, n\+\_\+columns, time\+\_\+scheme, state\+\_\+fldin, state\+\_\+fldout, sfc\+\_\+prop, diags, intrfc\+\_\+fld, cld\+\_\+prop,   rad\+\_\+tend, mdl\+\_\+parm, tbddata, dyn\+\_\+parm, state\+\_\+tracer, state\+\_\+\+T, state\+\_\+u, state\+\_\+v, w\+\_\+ls, omega, u\+\_\+g, v\+\_\+g, u\+\_\+nudge, v\+\_\+nudge, T\+\_\+nudge, thil\+\_\+nudge, qt\+\_\+nudge, d\+T\+\_\+dt\+\_\+rad, h\+\_\+advec\+\_\+thil, h\+\_\+advec\+\_\+qt, v\+\_\+advec\+\_\+thil, v\+\_\+advec\+\_\+qt, u\+\_\+force\+\_\+tend, v\+\_\+force\+\_\+tend, T\+\_\+force\+\_\+tend,   qv\+\_\+force\+\_\+tend, exner\+\_\+l, phii, pres\+\_\+l, lat, dt, lsswr, lslwr, thermo\+\_\+forcing\+\_\+type, mom\+\_\+forcing\+\_\+type, relax\+\_\+time)}{do_time_step(n_levels, n_columns, time_scheme, state_fldin, state_fldout, sfc_prop, diags, intrfc_fld, cld_prop,   rad_tend, mdl_parm, tbddata, dyn_parm, state_tracer, state_T, state_u, state_v, w_ls, omega, u_g, v_g, u_nudge, v_nudge, T_nudge, thil_nudge, qt_nudge, dT_dt_rad, h_advec_thil, h_advec_qt, v_advec_thil, v_advec_qt, u_force_tend, v_force_tend, T_force_tend,   qv_force_tend, exner_l, phii, pres_l, lat, dt, lsswr, lslwr, thermo_forcing_type, mom_forcing_type, relax_time)}}]{\setlength{\rightskip}{0pt plus 5cm}subroutine gmtb\+\_\+scm\+\_\+time\+\_\+integration\+::do\+\_\+time\+\_\+step (
\begin{DoxyParamCaption}
\item[{integer, intent(in)}]{n\+\_\+levels, }
\item[{integer, intent(in)}]{n\+\_\+columns, }
\item[{integer, intent(in)}]{time\+\_\+scheme, }
\item[{type(state\+\_\+fields\+\_\+in), intent(in)}]{state\+\_\+fldin, }
\item[{type(state\+\_\+fields\+\_\+out), intent(inout)}]{state\+\_\+fldout, }
\item[{type(sfc\+\_\+properties), intent(in)}]{sfc\+\_\+prop, }
\item[{type(diagnostics), intent(in)}]{diags, }
\item[{type(interface\+\_\+fields), intent(in)}]{intrfc\+\_\+fld, }
\item[{type(cloud\+\_\+properties), intent(in)}]{cld\+\_\+prop, }
\item[{type(radiation\+\_\+tendencies), intent(in)}]{rad\+\_\+tend, }
\item[{type(model\+\_\+parameters), intent(in)}]{mdl\+\_\+parm, }
\item[{type(tbd\+\_\+ddt), intent(in)}]{tbddata, }
\item[{type(dynamic\+\_\+parameters), intent(inout)}]{dyn\+\_\+parm, }
\item[{real(kind=dp), dimension(\+:,\+:,\+:,\+:), intent(inout)}]{state\+\_\+tracer, }
\item[{real(kind=dp), dimension(\+:,\+:,\+:), intent(inout)}]{state\+\_\+T, }
\item[{real(kind=dp), dimension(\+:,\+:,\+:), intent(inout)}]{state\+\_\+u, }
\item[{real(kind=dp), dimension(\+:,\+:,\+:), intent(inout)}]{state\+\_\+v, }
\item[{real(kind=dp), dimension(\+:,\+:), intent(in)}]{w\+\_\+ls, }
\item[{real(kind=dp), dimension(\+:,\+:), intent(in)}]{omega, }
\item[{real(kind=dp), dimension(\+:,\+:), intent(in)}]{u\+\_\+g, }
\item[{real(kind=dp), dimension(\+:,\+:), intent(in)}]{v\+\_\+g, }
\item[{real(kind=dp), dimension(\+:,\+:), intent(in)}]{u\+\_\+nudge, }
\item[{real(kind=dp), dimension(\+:,\+:), intent(in)}]{v\+\_\+nudge, }
\item[{real(kind=dp), dimension(\+:,\+:), intent(in)}]{T\+\_\+nudge, }
\item[{real(kind=dp), dimension(\+:,\+:), intent(in)}]{thil\+\_\+nudge, }
\item[{real(kind=dp), dimension(\+:,\+:), intent(in)}]{qt\+\_\+nudge, }
\item[{real(kind=dp), dimension(\+:,\+:), intent(in)}]{d\+T\+\_\+dt\+\_\+rad, }
\item[{real(kind=dp), dimension(\+:,\+:), intent(in)}]{h\+\_\+advec\+\_\+thil, }
\item[{real(kind=dp), dimension(\+:,\+:), intent(in)}]{h\+\_\+advec\+\_\+qt, }
\item[{real(kind=dp), dimension(\+:,\+:), intent(in)}]{v\+\_\+advec\+\_\+thil, }
\item[{real(kind=dp), dimension(\+:,\+:), intent(in)}]{v\+\_\+advec\+\_\+qt, }
\item[{real(kind=dp), dimension(\+:,\+:), intent(out)}]{u\+\_\+force\+\_\+tend, }
\item[{real(kind=dp), dimension(\+:,\+:), intent(out)}]{v\+\_\+force\+\_\+tend, }
\item[{real(kind=dp), dimension(\+:,\+:), intent(out)}]{T\+\_\+force\+\_\+tend, }
\item[{real(kind=dp), dimension(\+:,\+:), intent(out)}]{qv\+\_\+force\+\_\+tend, }
\item[{real(kind=dp), dimension(\+:,\+:), intent(in)}]{exner\+\_\+l, }
\item[{real(kind=dp), dimension(\+:,\+:), intent(in)}]{phii, }
\item[{real(kind=dp), dimension(\+:,\+:), intent(in)}]{pres\+\_\+l, }
\item[{real(kind=dp), dimension(\+:), intent(in)}]{lat, }
\item[{real(kind=dp), intent(in)}]{dt, }
\item[{logical, intent(in)}]{lsswr, }
\item[{logical, intent(in)}]{lslwr, }
\item[{integer, intent(in)}]{thermo\+\_\+forcing\+\_\+type, }
\item[{integer, intent(in)}]{mom\+\_\+forcing\+\_\+type, }
\item[{real(kind=dp), intent(in)}]{relax\+\_\+time}
\end{DoxyParamCaption}
)}\hypertarget{group__time__integration_ga32b72716e3e970874e9cb909ba66328d}{}\label{group__time__integration_ga32b72716e3e970874e9cb909ba66328d}


This subroutine calls nuopc\+\_\+rad\+\_\+update and nuopc\+\_\+rad\+\_\+run in nuopc\+\_\+physics.\+F90 (if necessary) and apply\+\_\+forcing\+\_\+leapfrog from \hyperlink{group__forcing}{gmtb\+\_\+scm\+\_\+forcing} and nuopc\+\_\+phys\+\_\+run, also from nuopc\+\_\+physics.\+F90. The subroutine nuopc\+\_\+rad\+\_\+update calculates the time-\/dependent parameters required to run radiation, and nuopc\+\_\+rad\+\_\+run calculates the radiative heating rate (but does not apply it). The subroutine apply\+\_\+forcing\+\_\+leapfrog advances the state variables forward using the leapfrog method and nuopc\+\_\+phys\+\_\+run further changes the state variables using the forward method. By the end of this subroutine, the unfiltered state variables will have been stepped forward in time. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em n\+\_\+levels} & number of model levels\\
\hline
\mbox{\tt in}  & {\em n\+\_\+columns} & number of model columns\\
\hline
\mbox{\tt in}  & {\em time\+\_\+scheme} & time-\/stepping scheme choice (1=forward, 2=filtered leapfrog)\\
\hline
\mbox{\tt in}  & {\em mdl\+\_\+parm} & N\+U\+O\+PC D\+DT containing model configuration parameters\\
\hline
\mbox{\tt in,out}  & {\em dyn\+\_\+parm} & N\+U\+O\+PC D\+DT containing parameters that change throughout the integration often\\
\hline
\mbox{\tt in}  & {\em state\+\_\+fldin} & N\+U\+O\+PC D\+DT containing the model state variables before the time step\\
\hline
\mbox{\tt in}  & {\em sfc\+\_\+prop} & N\+U\+O\+PC D\+DT containing surface variables\\
\hline
\mbox{\tt in}  & {\em diags} & N\+U\+O\+PC D\+DT containing diagnostic variables\\
\hline
\mbox{\tt in}  & {\em cld\+\_\+prop} & N\+U\+O\+PC D\+DT containing cloud property variables\\
\hline
\mbox{\tt in}  & {\em rad\+\_\+tend} & N\+U\+O\+PC D\+DT containing radiaitve tendencies\\
\hline
\mbox{\tt in}  & {\em intrfc\+\_\+fld} & N\+U\+O\+PC D\+DT containing interfacial variables\\
\hline
\mbox{\tt in,out}  & {\em state\+\_\+fldout} & N\+U\+O\+PC D\+DT that are updated during the time step\\
\hline
\mbox{\tt in}  & {\em tbddata} & N\+U\+O\+PC D\+DT containing unclassified variables\\
\hline
\mbox{\tt in,out}  & {\em state\+\_\+tracer} & model state tracers\\
\hline
\mbox{\tt in,out}  & {\em state\+\_\+t} & model state temperature\\
\hline
\mbox{\tt in,out}  & {\em state\+\_\+u} & model state zonal wind\\
\hline
\mbox{\tt in,out}  & {\em state\+\_\+v} & model state meridional wind\\
\hline
\mbox{\tt in}  & {\em w\+\_\+ls} & large scale w (m/s) (horizontal, vertical)\\
\hline
\mbox{\tt in}  & {\em omega} & large scale pressure velocity (Pa/s) (horizontal, vertical)\\
\hline
\mbox{\tt in}  & {\em u\+\_\+g} & geostrophic zonal wind (m/s) (horizontal, vertical)\\
\hline
\mbox{\tt in}  & {\em v\+\_\+g} & geostrophic meridional wind (m/s) (horizontal, vertical)\\
\hline
\mbox{\tt in}  & {\em u\+\_\+nudge} & nudging zonal wind (m/s) (horizontal, vertical)\\
\hline
\mbox{\tt in}  & {\em v\+\_\+nudge} & nudging meridional wind (m/s) (horizontal, vertical)\\
\hline
\mbox{\tt in}  & {\em t\+\_\+nudge} & nudging absolute temperature (K) (horizontal, vertical)\\
\hline
\mbox{\tt in}  & {\em thil\+\_\+nudge} & nudging liq. pot. temperatuer (K) (horizontal, vertical)\\
\hline
\mbox{\tt in}  & {\em qt\+\_\+nudge} & nudging specific humidity (K) (horizontal, vertical)\\
\hline
\mbox{\tt in}  & {\em dt\+\_\+dt\+\_\+rad} & radiative heating rate (K/s) (horizontal, vertical)\\
\hline
\mbox{\tt in}  & {\em h\+\_\+advec\+\_\+thil} & change in theta\+\_\+il due to horizontal advection (K/s) (horizontal, vertical)\\
\hline
\mbox{\tt in}  & {\em h\+\_\+advec\+\_\+qt} & change in q\+\_\+t due to horizontal advection (kg/kg /s) (horizontal, vertical)\\
\hline
\mbox{\tt in}  & {\em v\+\_\+advec\+\_\+thil} & change in theta\+\_\+il due to vertical advection (K/s) (horizontal, vertical)\\
\hline
\mbox{\tt in}  & {\em v\+\_\+advec\+\_\+qt} & change in q\+\_\+t due to vertical advection (kg/kg /s) (horizontal, vertical)\\
\hline
\mbox{\tt in}  & {\em lat} & latitude in radians\\
\hline
\mbox{\tt in}  & {\em dt} & time step (s)\\
\hline
\mbox{\tt in}  & {\em exner\+\_\+l} & exner function at model level centers (horizontal, vertical)\\
\hline
\mbox{\tt in}  & {\em phii} & geopotential at model level interfaces (horizontal, vertical)\\
\hline
\mbox{\tt in}  & {\em pres\+\_\+l} & pressure at model level centers (horizontal, vertical)\\
\hline
\mbox{\tt in}  & {\em relax\+\_\+time} & time scale for relaxation to observations (s)\\
\hline
\mbox{\tt in}  & {\em lsswr} & logical flag for calling shortwave radiation\\
\hline
\mbox{\tt in}  & {\em lslwr} & logical flag for calling longwave radiation\\
\hline
\mbox{\tt in}  & {\em thermo\+\_\+forcing\+\_\+type} & 1\+: \char`\"{}revealed forcing\char`\"{}, 2\+: \char`\"{}horizontal advective forcing\char`\"{}, 3\+: \char`\"{}relaxation forcing\char`\"{}\\
\hline
\mbox{\tt in}  & {\em mom\+\_\+forcing\+\_\+type} & 1\+: \char`\"{}revealed forcing\char`\"{}, 2\+: \char`\"{}horizontal advective forcing\char`\"{}, 3\+: \char`\"{}relaxation forcing\char`\"{}\\
\hline
\mbox{\tt out}  & {\em u\+\_\+force\+\_\+tend} & sum of all forcing for zonal momentum (horizontal, vertical)\\
\hline
\mbox{\tt out}  & {\em v\+\_\+force\+\_\+tend} & sum of all forcing for meridional momentum (horizontal, vertical)\\
\hline
\mbox{\tt out}  & {\em t\+\_\+force\+\_\+tend} & sum of all forcing for temperature (horizontal, vertical)\\
\hline
\mbox{\tt out}  & {\em qv\+\_\+force\+\_\+tend} & sum of all forcing for water vapor (horizontal, vertical) \\
\hline
\end{DoxyParams}
\hypertarget{group__time__integration_do_time_step_alg}{}\subsection{Algorithm}\label{group__time__integration_do_time_step_alg}

\begin{DoxyItemize}
\item Call nuopc\+\_\+rad\+\_\+update and nuopr\+\_\+rad\+\_\+run as necessary. State variables are not affected by these calls. Only radiative heating rates (and other rad. diagnostics) are returned.
\item Call apply\+\_\+forcing\+\_\+$\ast$ from \hyperlink{group__forcing}{gmtb\+\_\+scm\+\_\+forcing}. This routine updates the \char`\"{}input\char`\"{} state variables for the physics call. It effectively replaces the change of the state variables due to dynamics.
\item Call nuopc\+\_\+phys\+\_\+run to complete the forward time step. The unfiltered, updated state variables are in the N\+U\+O\+PC D\+DT state\+\_\+fldout, which points to state\+\_\+var(\+:,\+:,2).
\end{DoxyItemize}

Definition at line 54 of file gmtb\+\_\+scm\+\_\+time\+\_\+integration.\+f90.



References gmtb\+\_\+scm\+\_\+forcing\+::apply\+\_\+forcing\+\_\+forward\+\_\+euler(), and gmtb\+\_\+scm\+\_\+forcing\+::apply\+\_\+forcing\+\_\+leapfrog().



Referenced by gmtb\+\_\+scm\+\_\+main\+::gmtb\+\_\+scm\+\_\+main\+\_\+sub().

\index{gmtb\+\_\+scm\+\_\+time\+\_\+integration@{gmtb\+\_\+scm\+\_\+time\+\_\+integration}!filter@{filter}}
\index{filter@{filter}!gmtb\+\_\+scm\+\_\+time\+\_\+integration@{gmtb\+\_\+scm\+\_\+time\+\_\+integration}}
\subsubsection[{\texorpdfstring{filter(c\+\_\+filter, temp\+\_\+tracer, temp\+\_\+\+T, temp\+\_\+u, temp\+\_\+v, state\+\_\+tracer, state\+\_\+\+T, state\+\_\+u, state\+\_\+v)}{filter(c_filter, temp_tracer, temp_T, temp_u, temp_v, state_tracer, state_T, state_u, state_v)}}]{\setlength{\rightskip}{0pt plus 5cm}subroutine gmtb\+\_\+scm\+\_\+time\+\_\+integration\+::filter (
\begin{DoxyParamCaption}
\item[{real(kind=dp), intent(in)}]{c\+\_\+filter, }
\item[{real(kind=dp), dimension(\+:,\+:,\+:,\+:), intent(in)}]{temp\+\_\+tracer, }
\item[{real(kind=dp), dimension(\+:,\+:,\+:), intent(in)}]{temp\+\_\+T, }
\item[{real(kind=dp), dimension(\+:,\+:,\+:), intent(in)}]{temp\+\_\+u, }
\item[{real(kind=dp), dimension(\+:,\+:,\+:), intent(in)}]{temp\+\_\+v, }
\item[{real(kind=dp), dimension(\+:,\+:,\+:,\+:), intent(inout)}]{state\+\_\+tracer, }
\item[{real(kind=dp), dimension(\+:,\+:,\+:), intent(inout)}]{state\+\_\+T, }
\item[{real(kind=dp), dimension(\+:,\+:,\+:), intent(inout)}]{state\+\_\+u, }
\item[{real(kind=dp), dimension(\+:,\+:,\+:), intent(inout)}]{state\+\_\+v}
\end{DoxyParamCaption}
)}\hypertarget{group__time__integration_gadc22247097920b209bb2c62f4dfe8f75}{}\label{group__time__integration_gadc22247097920b209bb2c62f4dfe8f75}


This subroutine performs the Robert-\/\+Asselin time filtering of the state variables. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em c\+\_\+filter} & filter constant (equal to 1 -\/ the constant used in the G\+FS)\\
\hline
\mbox{\tt in}  & {\em temp\+\_\+tracer} & temporary copy of the state tracer variables before the latest forcing/physics update (horizontal, vertical, tracer\+\_\+index, iteration)\\
\hline
\mbox{\tt in}  & {\em temp\+\_\+t} & temporary copy of the state temperature before the latest forcing/physics update (horizontal, vertical, iteration)\\
\hline
\mbox{\tt in}  & {\em temp\+\_\+u} & temporary copy of the state zonal wind before the latest forcing/physics update (horizontal, vertical, iteration)\\
\hline
\mbox{\tt in}  & {\em temp\+\_\+v} & temporary copy of the state meridional wind before the latest forcing/physics update (horizontal, vertical, iteration)\\
\hline
\mbox{\tt in,out}  & {\em state\+\_\+tracer} & state tracer variables containing the section of the array to be updated and the section that contains the latest unfiltered values (horizontal, vertical, tracer\+\_\+index, iteration)\\
\hline
\mbox{\tt in,out}  & {\em state\+\_\+t} & state temperature containing the section of the array to be updated and the section that contains the latest unfiltered values (horizontal, vertical, iteration)\\
\hline
\mbox{\tt in,out}  & {\em state\+\_\+u} & state zonal wind containing the section of the array to be updated and the section that contains the latest unfiltered values (horizontal, vertical, iteration)\\
\hline
\mbox{\tt in,out}  & {\em state\+\_\+v} & state merdional wind containing the section of the array to be updated and the section that contains the latest unfiltered values (horizontal, vertical, iteration) \\
\hline
\end{DoxyParams}
\hypertarget{group__time__integration_filter_alg}{}\subsection{Algorithm}\label{group__time__integration_filter_alg}
The filtered state variables are calculated using \[ \overline{x^\tau}=(1-c)x^\tau + 0.5c\left(x^{\tau +1} + \overline{x^{\tau - 1}}\right) \] where $\overline{x^\tau}$ is the filtered value of variable $x$ at the current iteration, $x^\tau$ is the unfiltered value of the previous time step, $x^{\tau +1}$ is the unfiltered value that was just updated by the forcing and physics, and $\overline{x^{\tau - 1}}$ is the filtered value of the variable from the previous iteration, and $c$ is the filtering constant. 

Definition at line 22 of file gmtb\+\_\+scm\+\_\+time\+\_\+integration.\+f90.



Referenced by gmtb\+\_\+scm\+\_\+main\+::gmtb\+\_\+scm\+\_\+main\+\_\+sub().

